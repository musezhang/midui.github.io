<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[策略模式]]></title>
      <url>/2018/06/27/design-patterns-strategy/</url>
      <content type="html"><![CDATA[<h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p>定义一系列的算法,把它们一个个封装起来, 并且使它们可相互替换。本模式使得算法可独立于使用它的客户而变化。<br><a id="more"></a></p>
<h2 id="适用性"><a href="#适用性" class="headerlink" title="适用性"></a>适用性</h2><ul>
<li><p>许多相关的类仅仅是行为有异。“策略”提供了一种用多个行为中的一个行为来配置一个类的方法。</p>
</li>
<li><p>需要使用一个算法的不同变体。例如，你可能会定义一些反映不同的空间/时间权衡的算法。当这些变体实现为一个算法的类层次时[H087] ,可以使用策略模式。</p>
</li>
<li><p>算法使用客户不应该知道的数据。可使用策略模式以避免暴露复杂的、与算法相关的数据结构。</p>
</li>
<li><p>一个类定义了多种行为, 并且这些行为在这个类的操作中以多个条件语句的形式出现。将相关的条件分支移入它们各自的Strategy类中以代替这些条件语句。</p>
</li>
</ul>
<h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><p><img src="http://hi.csdn.net/attachment/201101/2/0_1293958978UANu.gif" alt="strategy"><br>策略模式中主要包含三部分，1.基本策略类(策略接口和其多种实现)；2、环境类(该类通过外部传入的选择逻辑，调用不同的策略执行);3客户端(具体的调用策略的主体代码)</p>
<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//策略类</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">sportss</span></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">play</span><span class="params">()</span></span>; </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">football</span> <span class="keyword">implements</span> <span class="title">sportss</span></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">play</span><span class="params">()</span></span></div><div class="line"><span class="function">	</span>&#123;</div><div class="line">		<span class="keyword">echo</span> <span class="string">"play football\n"</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">basketball</span> <span class="keyword">implements</span> <span class="title">sportss</span></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">play</span><span class="params">()</span></span></div><div class="line"><span class="function">	</span>&#123;</div><div class="line">		<span class="keyword">echo</span> <span class="string">"play basketball\n"</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">pingpong</span> <span class="keyword">implements</span> <span class="title">sportss</span></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">play</span><span class="params">()</span></span></div><div class="line"><span class="function">	</span>&#123;</div><div class="line">		<span class="keyword">echo</span> <span class="string">"play pingpong\n"</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//环境类</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">manager</span></span>&#123;</div><div class="line">	<span class="keyword">private</span> $sport;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($sport)</span></span></div><div class="line"><span class="function">	</span>&#123;</div><div class="line">		<span class="keyword">$this</span>-&gt;sport = $sport;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">playsports</span><span class="params">()</span></span></div><div class="line"><span class="function">	</span>&#123;</div><div class="line">		<span class="keyword">$this</span>-&gt;sport-&gt;play();</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//main</span></div><div class="line">$player = <span class="keyword">new</span> manager(<span class="keyword">new</span> football());</div><div class="line"></div><div class="line">$player-&gt;playsports();</div></pre></td></tr></table></figure>
<h2 id="特征说明"><a href="#特征说明" class="headerlink" title="特征说明"></a>特征说明</h2><ol>
<li>每个策略对应一个类，策略的选择是由客户端负责的。</li>
<li>扩展策略通过新增策略类实现。这样环境类和策略类不会修改，符合开闭原则</li>
<li>客户端实例化环境类的时候，会说明当前环境(策略相关参数)，然后环境类调用具体的策略方法</li>
</ol>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol>
<li><a href="http://www.cnblogs.com/beijiguangyong/archive/2010/11/15/2302807.html#_Toc281750468" target="_blank" rel="external">23种设计模式</a></li>
<li><a href="http://www.runoob.com/design-pattern/strategy-pattern.html" target="_blank" rel="external">策略模式</a></li>
<li><a href="https://www.awaimai.com/patterns/trategy" target="_blank" rel="external">策略模式</a></li>
</ol>
]]></content>
      
        <categories>
            
            <category> 代码的艺术 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> design patterns </tag>
            
            <tag> 策略模式 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[php中abstract类和接口的区别]]></title>
      <url>/2018/06/26/difference-of-abstract-and-interface/</url>
      <content type="html"><![CDATA[<p>本文主要讨论php中abstract类和接口的区别。下边所有讨论都针对php代码来说。<br><a href="https://github.com/musezhang/musezhang.github.io/issues" target="_blank" rel="external">【讨论地址】</a></p>
<p>在实际代码开发中，很多人经常会觉得抽象类和接口很类似。抽象类和接口都没有实现具体的方法，抽象类被继承后，在子类中对方法进行了具体的实现，接口也是类似。那么二者有什么区别呢。</p>
<a id="more"></a>
<h2 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>抽象类往往用来表征对问题领域进行分析、设计中得出的抽象概念，是对一系列看上去不同，但是本质上相同的具体概念的抽象。在编程语言中抽象类通常用<strong>abstract</strong>关键字来修饰</p>
<h3 id="特征"><a href="#特征" class="headerlink" title="特征"></a>特征</h3><ul>
<li>类名用<strong>abstract</strong> 关键字修饰</li>
<li>抽象类是类的一种，需要被继承</li>
<li>必须包含至少一个抽象方法，抽象方法没有方法体</li>
<li>抽象类不能实例化</li>
<li>子类必须定义抽象类中的所有抽象方法</li>
</ul>
<h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><h3 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h3><p>(自己总结)面向对象中的接口指的是一种特殊的数据结构，使用interface关键字修饰，他说明了类需要实现的所有方法，但并不实现它们</p>
<h3 id="特征-1"><a href="#特征-1" class="headerlink" title="特征"></a>特征</h3><ul>
<li>用<strong>interface</strong>关键字修饰，</li>
<li>具体的类使用<strong>implements</strong>关键字和他建立联系</li>
<li>不能被实例化</li>
<li>所有的方法都没有具体实现，只是一种声明（宣称自己有哪些方法）</li>
<li>所有的方法必须是共有的public</li>
</ul>
<h2 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h2><h3 id="相同点"><a href="#相同点" class="headerlink" title="相同点"></a>相同点</h3><ul>
<li>都是上层的抽象层,都是对一种类的抽象</li>
<li>都不能被实例化</li>
<li>都包含了不用实现的方法</li>
<li>抽象方法和接口方法的参数可以和子类方法参数不一致,子类的不一致参数需要有默认值;</li>
</ul>
<h3 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h3><ul>
<li>抽象类需要被继承，使用<strong>extends</strong>关键字，在子类中实现抽象方法；接口需要被类实现，使用<strong>implements</strong>关键字</li>
<li>抽象类中可以实现方法、声明方法；接口只做方法的声明</li>
<li>抽象类的方法可以是public和protected；接口的方法只能是public</li>
<li>一个类只能继承一个抽象类；但可以实现多个接口</li>
<li>抽象类中可以有静态方法，但是抽象方法不能是静态的；接口中不能有静态方法</li>
<li>抽象类中的成员变量可以是各种类型的;而接口中不能有变量(php)；</li>
<li>接口中常量不能被重载。</li>
</ul>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol>
<li><a href="https://www.zhihu.com/question/20149818" target="_blank" rel="external">接口和抽象类有什么区别</a></li>
<li><a href="https://www.cnblogs.com/dolphin0520/p/3811437.html" target="_blank" rel="external">深入理解Java的接口和抽象类</a></li>
<li><a href="https://www.cnblogs.com/azai/archive/2009/11/10/1599584.html" target="_blank" rel="external">抽象类和接口联系与区别</a></li>
<li><a href="http://php.net/manual/zh/language.oop5.interfaces.php" target="_blank" rel="external">对象接口</a></li>
<li><a href="http://www.php.net/manual/zh/language.oop5.abstract.php" target="_blank" rel="external">抽象类</a></li>
</ol>
]]></content>
      
        <categories>
            
            <category> php </category>
            
        </categories>
        
        
        <tags>
            
            <tag> php </tag>
            
            <tag> 抽象类 </tag>
            
            <tag> 接口 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[适配器模式]]></title>
      <url>/2018/06/26/design-patterns-adapter/</url>
      <content type="html"><![CDATA[<h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p>将一个类的接口转换成客户希望的另外一个接口。Adapter模式使得原来由于接口不兼容而不能一起工作的那此类可以一起工作<br><a id="more"></a></p>
<h2 id="适用性"><a href="#适用性" class="headerlink" title="适用性"></a>适用性</h2><p>你想使用一个已经存在的类，而它的接口不符合你的需求。<br>你想创建一个可以复用的类，该类可以与其他不相关的类或不可预见的类（即那些接口可能不一定兼容的类）协同工作。<br>（仅适用于对象Adapter ）你想使用一些已经存在的子类，但是不可能对每一个都进行子类化以匹配它们的接口。对象适配器可以适配它的父类接口。</p>
<h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><p><img src="http://hi.csdn.net/attachment/201101/2/0_1293958973OPpv.gif" alt="adapter"><br>适配器模式常见的有两种实现，一个是类适配器模式，一个是对象适配器模式。图中上边的为类适配器模式，下边的是对象适配器模式。<br>类适配器模式中，适配器将源adaptee当做类进行继承。在对象适配器模式中，适配器将源adaptee当做对象，持有该对象。</p>
<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//类适配器</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">language</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sayChinese</span><span class="params">()</span></span>;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sayEnglish</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">adaptee</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sayChinese</span><span class="params">()</span></span></div><div class="line"><span class="function">	</span>&#123;</div><div class="line">		<span class="keyword">echo</span> <span class="string">"你好\n"</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">adaptee</span> <span class="keyword">implements</span> <span class="title">language</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sayEnglish</span><span class="params">()</span></span></div><div class="line"><span class="function">	</span>&#123;</div><div class="line">		<span class="keyword">echo</span> <span class="string">"hello\n"</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//main</span></div><div class="line">$adapter = <span class="keyword">new</span> Adapter();</div><div class="line"></div><div class="line">$adapter-&gt;sayChinese();</div><div class="line">$adapter-&gt;sayEnglish();</div><div class="line"></div><div class="line"><span class="comment">//对象适配器</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">adaptee</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sayChinese</span><span class="params">()</span></span></div><div class="line"><span class="function">	</span>&#123;</div><div class="line">		<span class="keyword">echo</span> <span class="string">"你好\n"</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">language</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sayChinese</span><span class="params">()</span></span>;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sayEnglish</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Adapter2</span> <span class="keyword">implements</span> <span class="title">language</span></span>&#123;</div><div class="line">	<span class="keyword">private</span> $adaptee;</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($adaptee)</span></span></div><div class="line"><span class="function">	</span>&#123;</div><div class="line">		<span class="keyword">$this</span>-&gt;adaptee = $adaptee;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sayChinese</span><span class="params">()</span></span></div><div class="line"><span class="function">	</span>&#123;</div><div class="line">		<span class="keyword">$this</span>-&gt;adaptee-&gt;sayChinese();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sayEnglish</span><span class="params">()</span></span></div><div class="line"><span class="function">	</span>&#123;</div><div class="line">		<span class="keyword">echo</span> <span class="string">"hello\n"</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$adaptee = <span class="keyword">new</span> adaptee();</div><div class="line"></div><div class="line">$adapter2 = <span class="keyword">new</span> Adapter2($adaptee);</div><div class="line"></div><div class="line">$adapter2-&gt;sayChinese();</div><div class="line">$adapter2-&gt;sayEnglish();</div></pre></td></tr></table></figure>
<h2 id="特征说明"><a href="#特征说明" class="headerlink" title="特征说明"></a>特征说明</h2><p>1、类适配器通过继承源类，实现适配器<br>2、对象适配器通过持有源对象，实现适配器</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol>
<li><a href="https://www.jianshu.com/p/c52794e4edc0" target="_blank" rel="external">三种适配器模式 总结和使用场景</a></li>
<li><a href="http://www.cnblogs.com/beijiguangyong/archive/2010/11/15/2302807.html" target="_blank" rel="external">23种设计模式</a></li>
<li><a href="http://www.phppan.com/2010/07/php-design-pattern-10-adapter/" target="_blank" rel="external">PHP设计模式笔记：使用PHP实现适配器模式</a></li>
</ol>
]]></content>
      
        
    </entry>
    
    <entry>
      <title><![CDATA[三种工厂模式的区别]]></title>
      <url>/2018/06/20/design-patterns-diff-of-factory/</url>
      <content type="html"><![CDATA[<p>本文主要记录简单工厂模式、工厂模式、抽象工厂模式三者的区别</p>
<a id="more"></a>
<h3 id="三者的共同点是："><a href="#三者的共同点是：" class="headerlink" title="三者的共同点是："></a>三者的共同点是：</h3><p>1、都有两种作用不同的类：产品类和工厂类。其中，工厂类在自己的方法中实例化产品类（即使用new命令生成产品类的对象），并将生成的产品类的对象提供给外部使用。</p>
<p>2、创建的过程，都是类似的：工厂类得到一个标志（可以由程序输入，也可以读取配置文件中的内容），返回一个产品对象。 </p>
<h3 id="三种模式的区别："><a href="#三种模式的区别：" class="headerlink" title="三种模式的区别："></a>三种模式的区别：</h3><p><strong>简单工厂</strong>：用来生产同一等级结构中的任意产品，比如香蕉、苹果、梨就是同一等级结构中的三种商品。简单工厂通过一个含参的工厂方法，我们可以实例化任何产品类。<br>从开闭原则的角度来看，简单工厂模式不符合开闭原则，每次增加新的产品，都需要修改简单工厂类来适应新的产品。<br>优点：简答工厂的有点是实现简单，<br>缺点：(1)在遵循开闭原则的前提下，扩展产品很困难。(2)任何产品都通过简单工厂来实现，产品很多的情况下，简单工厂代码太重。</p>
<p>特别说明：但是在一些语言中(如PHP)，类名可以使用变量，所以简单工厂的两个缺点几乎不存在了。</p>
<p><strong>工厂模式</strong>：用来生成同一等级结构中的固定产品。工厂模式相当于将产品生产的操作提前，不由工厂来进行，工厂和产品呈现1对1的关系，所以，选择生产产品的变成了客户端，而不是工厂，客户端选择了工厂，意味着就选择了产品。增加新的产品，需要增加对应的工厂。<br>优点：（1）允许系统在不修改工厂角色的情况下引进新产品。(2)符合开闭原则，工厂和产品一旦建立，不会在进行代码的修改。如果有新的产品，属于扩展行为。<br>缺点：(1)每个新的产品对象的创建都需要创建专门的工厂类,实现复杂。</p>
<p><strong>抽象工厂</strong>：用来生成不同产品族的全部产品，如果每个产品族只有一个产品，其实抽象工厂就类似工厂模式了。抽象工厂模式里边生成一系列产品利用的是类的组合。每个从工厂里都可以实例化一系列的产品，实现一个产品族的生产。</p>
]]></content>
      
        <categories>
            
            <category> 代码的艺术 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> design patterns </tag>
            
            <tag> 抽象工厂模式 </tag>
            
            <tag> 工厂模式 </tag>
            
            <tag> 简单工厂模式 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[抽象工厂模式]]></title>
      <url>/2018/06/20/design-patterns-abstractfactory/</url>
      <content type="html"><![CDATA[<h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p>抽象工厂模式提供一个创建一系统相关或相互依赖对象的接口，而无需指定它们具体的类。<br><a id="more"></a></p>
<h2 id="适用性"><a href="#适用性" class="headerlink" title="适用性"></a>适用性</h2><p>一个系统要独立于它的产品的创建、组合和表示时。<br>一个系统要由多个产品系列中的一个来配置时。<br>当你要强调一系列相关的产品对象的设计以便进行联合使用时。<br>当你提供一个产品类库，而只想显示它们的接口而不是实现时。</p>
<h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><p><img src="http://img.my.csdn.net/uploads/201101/2/0_1293958972yHTZ.gif" alt="abstract_factory"><br>从图上可以看出，抽象工厂模式相比工厂模式，对产品类进行了进一步的抽象，等于是每个工厂能够生产一系列产品,不同的工厂生产不同系列的产品。主要该是有三个元素，1、client(调用工厂)；2、工厂类(生成者)；3、产品类</p>
<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//工厂类</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">abstractFactory</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getProductA</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getProductB</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">factoryA</span> <span class="keyword">implements</span> <span class="title">abstractFactory</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getProductA</span><span class="params">()</span></span></div><div class="line"><span class="function">	</span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ProductAA();</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getProductB</span><span class="params">()</span></span></div><div class="line"><span class="function">	</span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ProductAB();</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">factoryB</span> <span class="keyword">implements</span> <span class="title">abstractFactory</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getProductA</span><span class="params">()</span></span></div><div class="line"><span class="function">	</span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ProductBA();</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getProductB</span><span class="params">()</span></span></div><div class="line"><span class="function">	</span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ProductBB();</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//产品类</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">productA</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getProductName</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">productB</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getProductName</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductAA</span> <span class="keyword">implements</span> <span class="title">productA</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getProductName</span><span class="params">()</span></span></div><div class="line"><span class="function">	</span>&#123;</div><div class="line">		<span class="keyword">echo</span> <span class="string">"I am Product AA"</span> . PHP_EOL;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductAB</span> <span class="keyword">implements</span> <span class="title">productA</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getProductName</span><span class="params">()</span></span></div><div class="line"><span class="function">	</span>&#123;</div><div class="line">		<span class="keyword">echo</span> <span class="string">"I am Product AB"</span> . PHP_EOL;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductBA</span> <span class="keyword">implements</span> <span class="title">productB</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getProductName</span><span class="params">()</span></span></div><div class="line"><span class="function">	</span>&#123;</div><div class="line">		<span class="keyword">echo</span> <span class="string">"I am Product BA"</span> . PHP_EOL;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductBB</span> <span class="keyword">implements</span> <span class="title">productB</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getProductName</span><span class="params">()</span></span></div><div class="line"><span class="function">	</span>&#123;</div><div class="line">		<span class="keyword">echo</span> <span class="string">"I am Product BA"</span> . PHP_EOL;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//客户端</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">client</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">create</span><span class="params">()</span></span></div><div class="line"><span class="function">	</span>&#123;</div><div class="line">		<span class="keyword">self</span>::createProduct(<span class="keyword">new</span> factoryA);</div><div class="line">		<span class="keyword">self</span>::createProduct(<span class="keyword">new</span> factoryB);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">createProduct</span><span class="params">($factory)</span></span></div><div class="line"><span class="function">	</span>&#123;</div><div class="line">		$productAA = $factory-&gt;getProductA();</div><div class="line">		$productAB = $factory-&gt;getProductB();</div><div class="line"></div><div class="line">		$productAA-&gt;getProductName();</div><div class="line">	    $productAB-&gt;getProductName();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line">client::create();</div></pre></td></tr></table></figure>
<h2 id="特征说明"><a href="#特征说明" class="headerlink" title="特征说明"></a>特征说明</h2><p>1、工厂类实现统一的接口，每个工厂类对应一个系列的产品<br>2、每个系列的产品实现自己系列的接口<br>3、每一个系列的产品都是放在一起使用的。</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>1.<a href="http://zyjustin9.iteye.com/blog/2094960" target="_blank" rel="external">设计模式：简单工厂、工厂方法、抽象工厂之小结与区别</a><br>2.<a href="http://www.cnblogs.com/beijiguangyong/archive/2010/11/15/2302807.html" target="_blank" rel="external">23种设计模式</a><br>3.<a href="http://www.phppan.com/2010/05/php-design-pattern-3-abstract-factory/" target="_blank" rel="external">PHP设计模式笔记：使用PHP实现抽象工厂模式</a></p>
]]></content>
      
        <categories>
            
            <category> 代码的艺术 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> design patterns </tag>
            
            <tag> 抽象工厂模式 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[工厂模式]]></title>
      <url>/2018/06/20/design-patterns-factory/</url>
      <content type="html"><![CDATA[<h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p>定义一个用于创建对象的接口，让子类决定实例化哪一个类。Factory Method 使一个类的实例化延迟到其子类。<br><a id="more"></a></p>
<h2 id="适用性"><a href="#适用性" class="headerlink" title="适用性"></a>适用性</h2><p>当一个类不知道它所必须创建的对象的类的时候。<br>当一个类希望由它的子类来指定它所创建的对象的时候。<br>当类将创建对象的职责委托给多个帮助子类中的某一个，并且你希望将哪一个帮助子类是代理者这一信息局部化的时候。</p>
<h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><p><img src="http://dl2.iteye.com/upload/attachment/0099/4168/da787af4-8ca0-34df-8c2c-b9a13db31992.jpg" alt="factory"><br>从图上可以看出，工厂模式和简单工厂模式的区别是将工厂也进行了抽象，定义了工厂的接口，每个产品的生成由专门的工厂负责，主要有三个元素，1、client(调用工厂)；2、工厂类(生成者)；3、产品类</p>
<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//工厂类</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">factory</span></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getProduct</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">factoryA</span> <span class="keyword">implements</span> <span class="title">factory</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getProduct</span><span class="params">()</span></span></div><div class="line"><span class="function">	</span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ProductA();</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">factoryB</span> <span class="keyword">implements</span> <span class="title">factory</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getProduct</span><span class="params">()</span></span></div><div class="line"><span class="function">	</span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ProductB();</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//产品类</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">product</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getProductName</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">productA</span> <span class="keyword">implements</span> <span class="title">product</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getProductName</span><span class="params">()</span></span></div><div class="line"><span class="function">	</span>&#123;</div><div class="line">		<span class="keyword">echo</span> <span class="string">"I am product A"</span> . PHP_EOL;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">productB</span> <span class="keyword">implements</span> <span class="title">product</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getProductName</span><span class="params">()</span></span></div><div class="line"><span class="function">	</span>&#123;</div><div class="line">		<span class="keyword">echo</span> <span class="string">"I am product B"</span> . PHP_EOL;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//client</span></div><div class="line"><span class="keyword">try</span></div><div class="line">&#123;</div><div class="line">	<span class="comment">//生成产品A</span></div><div class="line">	$factory = <span class="keyword">new</span> factoryA();</div><div class="line">	$product = $factory-&gt;getProduct();</div><div class="line">	$product-&gt;getProductName();</div><div class="line"></div><div class="line">	<span class="comment">//生成产品B</span></div><div class="line">	$factory = <span class="keyword">new</span> factoryB();</div><div class="line">	$product = $factory-&gt;getProduct();</div><div class="line">	$product-&gt;getProductName();</div><div class="line">&#125;</div><div class="line"><span class="keyword">catch</span>(<span class="keyword">Exception</span> $e)</div><div class="line">&#123;</div><div class="line">	<span class="keyword">echo</span> $e-&gt;getMessage() . PHP_EOL;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="明显特征"><a href="#明显特征" class="headerlink" title="明显特征"></a>明显特征</h2><p>1、工厂类和简单工厂类相比，明显的特征就是创建产品不是一个工厂，而是多个工厂，相当于分工更加的明确<br>2、从client角度来看，创建产品不用在告诉工厂我要什么产品，而是直接找某个工厂要产品。</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>1.<a href="http://zyjustin9.iteye.com/blog/2094960" target="_blank" rel="external">设计模式：简单工厂、工厂方法、抽象工厂之小结与区别</a><br>2.<a href="http://www.cnblogs.com/beijiguangyong/archive/2010/11/15/2302807.html" target="_blank" rel="external">23种设计模式</a><br>3.<a href="http://www.phppan.com/2010/07/php-design-pattern-9-factory-method/" target="_blank" rel="external">PHP设计模式笔记：使用PHP实现工厂模式</a></p>
]]></content>
      
        <categories>
            
            <category> 代码的艺术 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> design patterns </tag>
            
            <tag> 工厂模式 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[待办]]></title>
      <url>/2018/06/20/towrite/</url>
      <content type="html"><![CDATA[<script src="/crypto-js.js"></script><script src="/mcommon.js"></script><h3 id="encrypt-message">sorry, you can't read this post!</h3><link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css"> <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap-theme.min.css"> <script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script> <script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script> <div id="security"> <div> <div class="input-group"> <input type="text" class="form-control" aria-label="Enter the password." id="pass"/> <div class="input-group-btn"> <button type="button" class="btn btn-default" onclick="decryptAES()">Decrypt</button> </div> </div> </div> </div> <div id="encrypt-blog" style="display:none"> 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 </div>]]></content>
      
        <categories>
            
            <category> 个人生活 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> houhou </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[php 多进程]]></title>
      <url>/2018/04/19/multi-process-of-php/</url>
      <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近在工作中遇到了一个php多进程的问题，脚本我是能写的，但是没有深入的了解过相关的内容。这篇就是对php处理多进程的一个简单的整理吧。<br>一搬来说，php都是一个单进程执行的，为了应对web并发请求的问题，我们借助服务器或PHP-FPM实现处理。但php的另一种使用场景是在cli模式下跑脚本或daemon来进行数据处理，这种情况下，就需要php自身对多进程的支持。<br>我们知道php是有很多扩展的，实现php的多进程主要依赖pcntl和posix两种扩展。下面主要针对这两种扩展进行介绍。<br><a id="more"></a></p>
<h1 id="多进程处理扩展"><a href="#多进程处理扩展" class="headerlink" title="多进程处理扩展"></a>多进程处理扩展</h1><p>php和进程相关的扩展其实很多的，这些扩展目前来说可以解决我们大多数对进程控制的场景，但很多我们并不经常用。经常用到的主要就是两个，一个PCNTL，一个POSIX。如果想了解的更多，可以参考<strong><a href="http://php.net/manual/zh/refs.fileprocess.process.php" target="_blank" rel="external">进程控制扩展</a></strong></p>
<h2 id="pcntl扩展"><a href="#pcntl扩展" class="headerlink" title="pcntl扩展"></a>pcntl扩展</h2><p>参考：<a href="http://php.net/manual/zh/book.pcntl.php" target="_blank" rel="external">PCNTL官方说明</a></p>
<h3 id="扩展说明"><a href="#扩展说明" class="headerlink" title="扩展说明"></a>扩展说明</h3><p>pcntl扩展提供了一系列进程控制函数来实现进程创建、程序执行、信号处理及进程中断处理。但是这类方法不能用于web服务器环境。</p>
<h3 id="主要函数"><a href="#主要函数" class="headerlink" title="主要函数"></a>主要函数</h3><p>pcntl控制函数很多，本人基于个人认知，大致分为了一下几类，会重点介绍其中的几个。</p>
<ol>
<li>进程控制</li>
</ol>
<ul>
<li><strong>pcntl_exec</strong>( string $path [, array $args [, array $envs ]] )在当前进程空间执行指定程序<ul>
<li>path:可执行文件路径</li>
<li>args:传递给程序的参数的字符串数组</li>
<li>envs:要传递给程序作为环境变量的字符串数组</li>
</ul>
</li>
<li><p><strong>pcntl_fork()</strong>:创建一个子进程(从当前位置往后是子进程内容)，子进程仅pid和父进程不同<br>返回值：0（当前在子进程中）；-1(创建进程失败)；&gt;0,在父进程中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?php</span></span></div><div class="line"><span class="php"></span></div><div class="line"><span class="php">$pid = pcntl_fork();</span></div><div class="line"><span class="php"><span class="comment">//父进程和子进程都会执行下面代码</span></span></div><div class="line"><span class="php"><span class="keyword">if</span> ($pid == <span class="number">-1</span>) &#123;</span></div><div class="line"><span class="php">    <span class="comment">//错误处理：创建子进程失败时返回-1.</span></span></div><div class="line"><span class="php">     <span class="keyword">die</span>(<span class="string">'could not fork'</span>);</span></div><div class="line"><span class="php">&#125; <span class="keyword">else</span> <span class="keyword">if</span> ($pid) &#123;</span></div><div class="line"><span class="php">     <span class="comment">//父进程会得到子进程号，所以这里是父进程执行的逻辑</span></span></div><div class="line"><span class="php">     pcntl_wait($status); <span class="comment">//等待子进程中断，防止子进程成为僵尸进程。</span></span></div><div class="line"><span class="php">&#125; <span class="keyword">else</span> &#123;</span></div><div class="line"><span class="php">     <span class="comment">//子进程得到的$pid为0, 所以这里是子进程执行的逻辑。</span></span></div><div class="line"><span class="php">&#125;</span></div><div class="line"><span class="php"></span></div><div class="line"><span class="php"><span class="meta">?&gt;</span></span></div></pre></td></tr></table></figure>
</li>
<li><p><strong>pcntl_getpriority</strong>：查询指定pid进程的优先级<br><strong><em>int pcntl_getpriority ([ int $pid = getmypid() [, int $process_identifier = PRIO_PROCESS ]] )</em></strong></p>
</li>
<li><strong>pcntl_setpriority</strong>: 设置指定pid进程的优先级<br><strong><em>bool pcntl_setpriority ( int $priority [, int $pid = getmypid() [, int $process_identifier = PRIO_PROCESS ]] )</em></strong></li>
<li><strong>pcntl_wait</strong>：等待或返回fork的子进程状态<br><strong><em>int pcntl_wait ( int &amp;$status [, int $options = 0 ] )</em></strong><br>挂起当前进程的执行直到一个子进程退出或接收到一个信号要求中断当前进程或调用一个信号处理函数。</li>
<li><strong>pcntl_waitpid</strong>：挂起当前进程的执行直到参数pid指定的进程号的进程退出， 或接收到一个信号要求中断当前进程或调用一个信号处理函数<br>如果pid指定的子进程在此函数调用时已经退出（俗称僵尸进程），此函数 将立刻返回</li>
</ul>
<ol>
<li>信号处理</li>
</ol>
<ul>
<li><strong>pcntl_alarm(int $seconds)</strong>:为进程创建闹钟信号，在指定的秒数后向进程发送一个SIGALRM信号</li>
<li><strong>pcntl_async_signals</strong>(bool $on = NULL ] )启用/禁用异步信号处理,如果不传参数，返回是否启用了异步信号处理</li>
<li><strong>pcntl_signal_dispatch</strong>：调用等待信号的处理器，等待信号的处理器使用pcntl_signal() 创建安装</li>
<li><strong>pcntl_signal_get_handler</strong>：获取指定信号的当前处理程序</li>
<li><strong>pcntl_signal</strong>：为指定编号的信号安装一个信号处理器<br><strong><em>bool pcntl_signal ( int $signo , callback $handler [, bool $restart_syscalls = true ] )</em></strong><ul>
<li>signo 信号编号</li>
<li>handler 信号处理器(程序)可以是用户创建的函数或方法的名字，也可以是系统常量 SIG_IGN（译注：忽略信号处理程序）或SIG_DFL（默认信号处理程序）.</li>
<li>restart_syscalls:指定当信号到达时系统调用重启是否可用（详见官网说明）</li>
</ul>
</li>
<li><strong>pcntl_sigprocmask</strong>：用来增加，删除或设置阻塞信号</li>
<li><strong>pcntl_sigtimedwait</strong>：带超时机制的信号等待</li>
<li><strong>pcntl_sigwaitinfo</strong>：暂停调用脚本的执行直到接收到set 参数中列出的某个信号，</li>
</ul>
<ol>
<li>其他：</li>
</ol>
<ul>
<li><strong>pcntl_errno</strong>:函数pcntl_get_last_error()的别名</li>
<li><strong>pcntl_get_last_error</strong>：返回最近一次pcntl函数错误的错误码</li>
<li><strong>pcntl_strerror</strong>：根据错误编号获取系统错误描述</li>
<li><strong>pcntl_wexitstatus</strong>:返回一个中断的子进程的返回代码</li>
<li><strong>pcntl_wifexited</strong>:检查子进程状态代码是否代表正常退出。</li>
<li><strong>pcntl_wifsignaled</strong>:检查子进程是否是由于某个未捕获的信号退出的。</li>
<li><strong>pcntl_wifstopped</strong>:检查子进程当前是否已经停止</li>
<li><strong>pcntl_wstopsig</strong>:返回导致子进程停止的信号</li>
<li><strong>pcntl_wtermsig</strong>:返回导致子进程中断的信号</li>
</ul>
<h3 id="应用实例"><a href="#应用实例" class="headerlink" title="应用实例"></a>应用实例</h3><p>如果不需要涉及到信号量处理相关的内容，那么一个最简单的php多进程脚本代码大致如下：<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line"></div><div class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span>&lt;<span class="number">3</span>; ++<span class="variable">$i</span>)&#123;</div><div class="line">    <span class="variable">$pids</span>[<span class="variable">$i</span>] = pcntl_fork();</div><div class="line">    <span class="keyword">if</span> (<span class="variable">$pid</span>[<span class="variable">$i</span>] == -<span class="number">1</span>)&#123;</div><div class="line">        die (<span class="string">"cannot fork"</span> );</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$pid</span> &gt; <span class="number">0</span>)&#123;</div><div class="line">        echo <span class="string">"parent continue \n"</span>;</div><div class="line">    &#125; </div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$pid</span> == <span class="number">0</span>)</div><div class="line">    &#123;</div><div class="line">        echo <span class="string">"child start, pid "</span>, getmypid(), <span class="string">"\n"</span> ;</div><div class="line">        <span class="keyword">exit</span> (<span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="regexp">//</span>对进程进行回收</div><div class="line">foreach (<span class="variable">$pids</span> as <span class="variable">$pid</span>)</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span>(<span class="variable">$pid</span>) &#123;</div><div class="line">        pcntl_waitpid(<span class="variable">$pid</span>, <span class="variable">$status</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="特别说明"><a href="#特别说明" class="headerlink" title="特别说明"></a>特别说明</h3><p>在php多进程脚本中，有几个需要重点理解的点：</p>
<ol>
<li>pcntl_fork的返回值:&gt;0,在父进程中;=0，创建子进程成功，进入子进程;&lt;0(就是-1)创建失败</li>
<li>pcntl_wait和pcntl_waitpid的区别:二者都是挂起进程直到进程退出或中断后进行后续，但是pcntl_wait无法指定pid，所以必须在创建子进程的循环中出现，但是这样会造成脚本变为串行，所以可以使用pcntl_waitpid，在创建完所有的子进程后，对进程进行回收，防止出现僵尸进程(也可能和参数有关，后续调研)</li>
<li>子进程执行的代码是pcntl_fork之后的代码</li>
</ol>
<h2 id="posix扩展"><a href="#posix扩展" class="headerlink" title="posix扩展"></a>posix扩展</h2><p><a href="http://php.net/manual/zh/intro.posix.php" target="_blank" rel="external">参考</a></p>
<h3 id="扩展说明-1"><a href="#扩展说明-1" class="headerlink" title="扩展说明"></a>扩展说明</h3><p>POSIX表示可移植操作系统接口（Portable Operating System Interface of UNIX，缩写为 POSIX ），POSIX标准定义了操作系统应该为应用程序提供的接口标准，是IEEE为要在各种UNIX操作系统上运行的软件而定义的一系列API标准的总称.<br>posix扩展包含了定义在 IEEE 1003.1(POSIX.1)标准文档里的函数的接口,(windows不可用，无检测，不需要的情况下建议关闭)<br>所以posix扩展中的一些函数通常会与pcntl扩展配合使用。</p>
<h3 id="主要函数-1"><a href="#主要函数-1" class="headerlink" title="主要函数"></a>主要函数</h3><p><strong>posix_access(string $file[, int $mode = POSIX_F_OK])</strong> :查看用户对文件是否具有指定的权限<br>    $file - 文件名<br>    $mode - 权限，包含：POSIX_F_OK, POSIX_R_OK, POSIX_W_OK, POSIX_X_OK的一个或多个。<br><strong>posix_ctermid()</strong>:返回当前进程所在的当前控制终端的路径名<br><strong>posix_errno()</strong>:posix_get_last_error()别名<br><strong>posix_get_last_error()</strong>:返回最近一次最后的posix函数调用失败的错误号。错误号关联的错误消息，可通过 ‘posix_strerror()’ 来获取<br><strong>posix_strerror(int $errno)</strong>：通过给定的错误号，返回关联的POSIX系统错误消息<br><strong>posix_getcwd()</strong>:取当前脚本的工作目录的绝对路径<br><strong>posix_getegid()</strong>返回当前进程的有效用户组ID<br><strong>posix_geteuid()</strong>返回当前进程的有效用户ID<br><strong>posix_getgid()</strong>返回当前进程的真实用户组ID<br><strong>posix_getuid()</strong>:返回当前进程的真实用户ID<br>上述四个方法中有效和真实的含义参见<a href="https://www.cnblogs.com/kunhu/p/3699883.html" target="_blank" rel="external">inux进程的实际用户ID和有效用户ID</a><br><strong>posix_getgrgid(int $gid)</strong>通过传入组ID，获取给定的用户组的相关信息，返回值如下<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Array</span></div><div class="line">(</div><div class="line">    [name] =&gt; staff</div><div class="line">    [passwd] =&gt; *</div><div class="line">    [members] =&gt; <span class="keyword">Array</span></div><div class="line">        (</div><div class="line">            [<span class="number">0</span>] =&gt; root</div><div class="line">            [<span class="number">1</span>] =&gt; muse</div><div class="line">        )</div><div class="line"></div><div class="line">    [gid] =&gt; <span class="number">20</span></div><div class="line">)</div></pre></td></tr></table></figure></p>
<p><strong>posix_getgrnam(string $name)</strong>:通过传入组名称，获取给定的用户组的相关信息,返回值同上<br><strong>posix_getgroups()</strong>：获取当前进程的用户组集合<br><strong>posix_getlogin()</strong>:返回拥有当前进程的用户的登陆名<br><strong>posix_getpgid(int $pid)</strong>:获取指定进程的进程组标识符(进程组id)，返回整数<br>    注意：<br>        该函数不是POSIX函数，但是常见于BSD和System V的系统上。如果系统不支持该函数，在编译时就不会被包含进来。应该提前使用 ‘function_exists()’ 检查，存在再使用<br><strong>posix_getpgrp()</strong>:获取当前进程的进程组标识符(进程组id)，返回整数<br><strong>posix_getpid()</strong>:获取当前进程的进程标识符(进程id)<br><strong>posix_getppid()</strong>:获取当前进程的父进程标识符(父进程id)<br><strong>posix_getpwnam(string $username)</strong>:通过用户名，获取给定用户的信息。返回值如下：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Array</span></div><div class="line">(</div><div class="line">    [name] =&gt; jack   <span class="comment">//用户名,和传入参数一致，太长的话会被截断，保留16个字符</span></div><div class="line">    [passwd] =&gt; ******** <span class="comment">//密码</span></div><div class="line">    [uid] =&gt; <span class="number">502</span> <span class="comment">//用户id</span></div><div class="line">    [gid] =&gt; <span class="number">20</span>  <span class="comment">//用户组id</span></div><div class="line">    [gecos] =&gt; <span class="string">"jack,,"</span> <span class="comment">//一个过时的元素，包含了 ','分隔的用户的全名、办公室电话、办公室号码以及家庭电话号码。大多数的系统上，只有用户的全名有效。  </span></div><div class="line">    [dir] =&gt; /Users/tom <span class="comment">//用户根目录</span></div><div class="line">    [shell] =&gt; /bin/bash <span class="comment">//可执行的用户的默认shell的绝对路径  </span></div><div class="line">)</div></pre></td></tr></table></figure></p>
<p><strong>posix_getpwuid(int $uid)</strong>:通过用户id，获取给定用户的信息,返回结果同上<br><strong>posix_getrlimit()</strong>:返回一个关于当前资源的软限制和硬限制的信息数组,软硬限制可查询百度<br><strong>posix_getsid(int $pid)</strong>:返回指定进程的session ID。进程的session ID是会话领导者(session leader)的进程组id<br><strong>posix_initgroups(string $name, int $base_group_id)</strong>：对指定的用户，计算其组访问列表<br><strong>posix_isatty(mixed $fd)</strong>:检查文件描述符是否是一个有效的终端类型的设置(是否是tty)<br><strong>posix_kill(int $pid, int $sig)</strong>:给指定的进程发送一个$sig指定的信号！<br>    参数：<br>        $pid - 进程id<br>        $sig - PCNTL信号预定义常量<br><strong>posix_mkfifo(string $pathname, int $mode)</strong>:创建一个特殊的FIFO文件，存在于文件系统，并且作为进程的双向通信桥梁(其实就是创建一个先入先出的管道，可以使用文件操作方法写入和读取文件)<br>    参数：<br>        $pathname - FIFO文件(管道)<br>        $mode - 必须是8进制格式。新创建的FIFO的权限，也依赖于当前的umask()设置。新创建的文件权限是(mode &amp; ~umask)<br><strong>posix_mknod(string $pathname, int $mode[, int $major = 0[, int $minor = 0]])</strong>：创建一个特殊的或者一般的文件<br><strong>posix_setegid(int $gid)</strong>：设置当前进程的有效组ID。这是个特权函数，需要操作系统上具有特殊权限(通常是root权限)，才能执行该函数。<br><strong>posix_seteuid(int $uid)</strong>：设置当前进程的有效用户ID。这是个特权函数，需要操作系统上具有特殊权限(通常是root权限)，才能执行该函数。<br><strong>posix_setgid(int $gid)</strong>：设置当前进程的真实用户组ID。这是个特权函数，需要操作系统上具有特殊权限(通常是root权限)，才能执行该函数。函数调用的适当的顺序是：首先调用 posix_setgid()，最后调用 posix_setuid()。<br><strong>posix_setpgid(int $pid, int $pgid)</strong>:设置指定进程的进程组ID<br><strong>posix_setrlimit(int $resource, int $softlimit, int $hardlimit)</strong>：设置给定系统资源的软限制和硬限制。<br><strong>posix_setsid()</strong>:设置当前进程为session leader(会话领导者)<br><strong>posix_setuid(int $uid)</strong>:设置当前进程的真实用户ID。这是个特权函数，需要操作系统上具有特殊权限(通常是root权限)，才能执行该函数。<br><strong>posix_times()</strong>:获取当前CUP使用信息。警告：函数不可靠，对于高时间(high times)可能返回负值。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Array</span></div><div class="line">(</div><div class="line">    [ticks] =&gt; <span class="number">152559307291</span>   <span class="comment">//重启到现在，已经过去的 clock ticks 个数</span></div><div class="line">    [utime] =&gt; <span class="number">5</span>              <span class="comment">//当前进程使用的用户时间</span></div><div class="line">    [stime] =&gt; <span class="number">6</span>              <span class="comment">//当前进程使用的系统时间 </span></div><div class="line">    [cutime] =&gt; <span class="number">0</span>             <span class="comment">//当前进程和子进程使用的用户时间</span></div><div class="line">    [cstime] =&gt; <span class="number">0</span>             <span class="comment">//当前进程和子进程使用的系统时间</span></div><div class="line">)</div></pre></td></tr></table></figure></p>
<p><strong>posix_ttyname($mixed $fd)</strong>：返回当前打开的文件描述符所在的终端设备的绝对路径<br><strong>posix_uname()</strong>:获取系统相关信息(同<strong><em>uname -a</em></strong> 命令)。</p>
<pre><code>Array
(
    [sysname] =&gt; Darwin  //操作系统名，如Linux
    [nodename] =&gt; localhost  //系统名称
    [release] =&gt; 16.0.0  //操作系统发布版
    [version] =&gt; Darwin Kernel Version 16.0.0: Mon Aug 29 17:56:20 PDT 2016; root:xnu-3789.1.32~3/RELEASE_X86_64//操作系统版本
    [machine] =&gt; x86_64   //系统平台
    [domainname] =&gt; (none) //dns域名
)
</code></pre><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>1.<a href="https://my.oschina.net/junn/blog/158552" target="_blank" rel="external">PHP多进程编程</a><br>2.<a href="https://juejin.im/post/5a1ff1396fb9a0451704fb42" target="_blank" rel="external">从0到1优雅的实现PHP多进程管理</a><br>3.<a href="https://my.oschina.net/junn/blog/158639" target="_blank" rel="external">PHP多进程实践</a><br>4.<a href="https://blog.csdn.net/beyond__devil/article/details/53820723" target="_blank" rel="external">POSIX函数</a><br>5.<a href="https://baike.baidu.com/item/POSIX/3792413?fr=aladdin" target="_blank" rel="external">POSIX百度百科</a></p>
]]></content>
      
        <categories>
            
            <category> php </category>
            
        </categories>
        
        
        <tags>
            
            <tag> php </tag>
            
            <tag> 多进程 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[php中json_encode和json_decode的说明]]></title>
      <url>/2018/03/20/json-encode-of-php/</url>
      <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p>最近在使用json_encode函数的时候，发现自己以前使用json_encode太简单了。很多细节没有注意到，虽然也能用，但是却引发了一些问题。所以本文主要去记录下json_encode和json_decode的项目用法。</p>
</blockquote>
<a id="more"></a>
<h2 id="json-encode"><a href="#json-encode" class="headerlink" title="json_encode"></a>json_encode</h2><h3 id="函数说明"><a href="#函数说明" class="headerlink" title="函数说明"></a>函数说明</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">string</span> json_encode ( mixed $value [, <span class="built_in">int</span> $options = <span class="number">0</span> [, <span class="built_in">int</span> $depth = <span class="number">512</span> ]] )</div></pre></td></tr></table></figure>
<p>返回包含所提供值的JSON表示的字符串</p>
<h3 id="详细参数说明"><a href="#详细参数说明" class="headerlink" title="详细参数说明"></a>详细参数说明</h3><p><strong>value</strong>: 可以是任何非resource类型的任何数据类型的值<br><strong>options</strong>: 对value进行encode的选项,主要是控制特殊字符是否进行unicode编码，可以设置选项如下：</p>
<ul>
<li><p>JSON_HEX_TAG =&gt; 1 : 所有的 <font color="red"><strong>&lt;</strong></font> 和 <font color="red"><strong>&gt;</strong></font> 符号都被转换成\u003C和\u003E(since 5.3.0)</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$value</span> = <span class="string">"hello &lt;jcak&gt;"</span>;</div><div class="line">echo json_encode(<span class="variable">$value</span>) . <span class="string">"\n"</span>;  <span class="regexp">//</span>输出<span class="string">"hello &lt;jack&gt;"</span></div><div class="line">echo json_encode(<span class="variable">$value</span>, JSON_HEX_TAG) . <span class="string">"\n"</span>; <span class="regexp">//</span>输出<span class="string">"hello \u003Cjack\u003E"</span></div></pre></td></tr></table></figure>
</li>
<li><p>JSON_HEX_AMP =&gt; 2 : 所有的 <font color="red"><strong>&amp;</strong></font> 转换为\u0026(since 5.3.0)</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$value</span> = <span class="string">"hello jack &amp;"</span>;</div><div class="line">echo json_encode(<span class="variable">$value</span>) . <span class="string">"\n"</span>;  <span class="regexp">//</span>输出<span class="string">"hello jack &amp;"</span></div><div class="line">echo json_encode(<span class="variable">$value</span>, JSON_HEX_AMP) . <span class="string">"\n"</span>; <span class="regexp">//</span>输出<span class="string">"hello jack \u0026"</span></div></pre></td></tr></table></figure>
</li>
<li><p>JSON_HEX_APOS =&gt; 4：所有的单引号 <font color="red"><strong>‘</strong></font> 转换成\u0027(since 5.3.0)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$value</span> = <span class="string">"hello 'jack'"</span>;</div><div class="line"><span class="built_in">echo</span> json_encode(<span class="variable">$value</span>) . <span class="string">"\n"</span>;  //输出<span class="string">"hello 'jack'"</span></div><div class="line"><span class="built_in">echo</span> json_encode(<span class="variable">$value</span>, JSON_HEX_AMP) . <span class="string">"\n"</span>; <span class="string">"hello \u0027jack\u0027"</span></div></pre></td></tr></table></figure>
</li>
<li><p>JSON_HEX_QUOT =&gt; 8 : 所有的双引号 <font color="red"><strong>“</strong></font> 转换成\u0022（since 5.3.0)</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$value</span> = <span class="string">'hello "jack"'</span>;</div><div class="line">echo json_encode(<span class="variable">$value</span>) . <span class="string">"\n"</span>; <span class="regexp">//</span>输出<span class="string">"hello \"jack\""</span> ，为了区别外层的双引号，增加了转义字符，</div><div class="line">echo json_encode(<span class="variable">$value</span>, JSON_HEX_QUOT) . <span class="string">"\n"</span>; <span class="regexp">//</span>输出<span class="string">"hello \u0022jack\u0022"</span></div></pre></td></tr></table></figure>
</li>
<li><p>JSON_FORCE_OBJECT =&gt; 16 : 当使用非关联数组时，输出一个对象而不是数组。当输出的接收者<strong><em>期待对象并且数组为空时特别有用</em></strong>。(since 5.3.0)</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$value</span> = array(<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>);</div><div class="line">echo json_encode(<span class="variable">$value</span>) . <span class="string">"\n"</span>; <span class="regexp">//</span>输出[<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>]</div><div class="line">echo json_encode(<span class="variable">$value</span>, JSON_FORCE_OBJECT) . <span class="string">"\n"</span>; <span class="regexp">//</span>输出&#123;<span class="string">"0"</span>:<span class="string">"a"</span>,<span class="string">"1"</span>:<span class="string">"b"</span>,<span class="string">"2"</span>:<span class="string">"c"</span>&#125;</div><div class="line"></div><div class="line"><span class="variable">$value</span> = array();</div><div class="line">echo json_encode(<span class="variable">$value</span>) . <span class="string">"\n"</span>; <span class="regexp">//</span>输出[]</div><div class="line">echo json_encode(<span class="variable">$value</span>, JSON_FORCE_OBJECT) . <span class="string">"\n"</span>; <span class="regexp">//</span>输出&#123;&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>JSON_NUMERIC_CHECK =&gt; 32 : 将数字字符串编码为数字(since 5.3.3)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash">value = <span class="string">"123456"</span>;</span></div><div class="line"><span class="meta">var_dump(json_encode($</span><span class="bash">value)); //输出string(8) <span class="string">""</span>123456<span class="string">""</span>,可以看出，转换出来的是字符串</span></div><div class="line"><span class="meta">var_dump(json_encode($</span><span class="bash">value, JSON_NUMERIC_CHECK));//输出string(6) <span class="string">"123456"</span>,可以看出转换出来的是数字，比不加参数，少两个字符</span></div></pre></td></tr></table></figure>
</li>
<li><p>JSON_UNESCAPED_SLASHES =&gt; 64 : 不对反斜杠 <font color="red"><strong>/</strong></font>进行转义(since 5.4.0)</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$value</span> = <span class="string">"/hello jack"</span>;</div><div class="line">echo json_encode(<span class="variable">$value</span>) . <span class="string">"\n"</span>; <span class="regexp">//</span>输出 <span class="string">"\/hello jack"</span>，做了转义处理</div><div class="line">echo json_encode(<span class="variable">$value</span>, JSON_UNESCAPED_SLASHES)) . <span class="string">"\n"</span>;<span class="regexp">//</span> 输出string(<span class="number">13</span>) <span class="string">"/hello jack"</span>，未作转义处理</div></pre></td></tr></table></figure>
</li>
<li><p>JSON_PRETTY_PRINT =&gt; 128 : 格式化返回的数据,美化输出，一般数组很有效(since 5.4.0)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$value = <span class="keyword">array</span>(<span class="string">"word"</span> =&gt; <span class="string">"hello jack"</span>);</div><div class="line"><span class="keyword">echo</span> json_encode($value) . <span class="string">"\n"</span>; <span class="comment">//输出&#123;"word":"hello jack"&#125;</span></div><div class="line"><span class="keyword">echo</span> json_encode($value, JSON_PRETTY_PRINT) . <span class="string">"\n"</span>;</div><div class="line"><span class="comment">//输出如下：</span></div><div class="line">&#123;</div><div class="line">    <span class="string">"word"</span>: <span class="string">"hello jack"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>JSON_UNESCAPED_UNICODE =&gt; 256 :从字面上对多字节Unicode字符进行编码，如对<strong><em>中文不进行unicode转码</em></strong>，不会转换为\uXXXX这种格式(since 5.4.0)</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$value</span> = <span class="string">"hello jack, 这是一条测试信息"</span>;</div><div class="line">echo json_encode(<span class="variable">$value</span>) . <span class="string">"\n"</span>; <span class="regexp">//</span>输出<span class="string">"hello jack, \u8fd9\u662f\u4e00\u6761\u6d4b\u8bd5\u4fe1\u606f"</span></div><div class="line">echo json_encode(<span class="variable">$value</span>, JSON_UNESCAPED_UNICODE) . <span class="string">"\n"</span>; <span class="regexp">//</span>输出<span class="string">"hello jack, 这是一条测试信息"</span></div></pre></td></tr></table></figure>
</li>
<li><p>JSON_PARTIAL_OUTPUT_ON_ERROR =&gt; 512 :用一些不可修改的值代替失败(since 5.5.0)</p>
</li>
<li>JSON_PRESERVE_ZERO_FRACTION =&gt; 1024 : 确保浮点值始终编码为浮点值(since 5.6.6)<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$value = <span class="number">277.00000</span>;</div><div class="line"><span class="keyword">echo</span> json_encode($value) . <span class="string">"\n"</span>; <span class="comment">//输出：277，整数</span></div><div class="line"><span class="keyword">echo</span> json_encode($value, JSON_PRESERVE_ZERO_FRACTION) . <span class="string">"\n"</span>; <span class="comment">//输出277.0 浮点数</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>depth</strong>: 设置最大深度，必须大于0，主要是针对数组来说的，是可以encode的数组的最大深度<br><figure class="highlight xquery"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$value = <span class="keyword">array</span>(<span class="string">"name"</span> =&gt; <span class="string">"midui"</span>, <span class="string">"location"</span> =&gt; <span class="keyword">array</span>(<span class="string">"province"</span>=&gt;<span class="string">"beijing"</span>, <span class="string">"city"</span>=&gt; <span class="string">"beijing"</span>));</div><div class="line">echo json_encode($value) . <span class="string">"\n"</span>; </div><div class="line">//输出&#123;<span class="string">"name"</span>:<span class="string">"midui"</span>,<span class="string">"location"</span>:&#123;<span class="string">"province"</span>:<span class="string">"beijing"</span>,<span class="string">"city"</span>:<span class="string">"beijing"</span>&#125;&#125;</div><div class="line">echo json_encode($value, JSON_PRESERVE_ZERO_FRACTION, <span class="number">1</span>) . <span class="string">"\n"</span>; </div><div class="line">//无法encode,注意，此时把第二个参数修改为JSON_PARTIAL_OUTPUT_ON_ERROR,则可以encode，原因不明</div></pre></td></tr></table></figure></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>一般来说，我们使用json_encode都没有使用后两个参数，但是在某些特定的情况下，有一些参数还是可以供我们使用的。<br>如：</p>
<ul>
<li>需要对特殊符号(&lt;,&gt;,’,”,&amp;)进行编码的,使用<strong>JSON_HEX_TAG,JSON_HEX_AMP,JSON_HEX_APOS,JSON_HEX_QUOT</strong>等</li>
<li>不需要对中文进行编码的情况，使用<strong>JSON_UNESCAPED_UNICODE</strong></li>
<li>需要将空数组编码为对象，而不是数组的时候使用<strong>JSON_FORCE_OBJECT</strong></li>
<li>如果要使用多个参数，则可以将参数值相加，如同时需要对&lt;和&amp;进行编码,但不对中文编码，那么<blockquote>
<p>第二个参数值 = JSON_HEX_TAG + JSON_HEX_AMP + JSON_UNESCAPED_UNICODE = 259</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="formula">$value = "hello &lt;jack&gt; &amp;, 你是谁";</span></div><div class="line"><span class="formula">echo json_encode($</span>value) . "<span class="tag">\<span class="name">n</span></span>"; //不特殊处理，输出"hello &lt;jack&gt; &amp;, <span class="tag">\<span class="name">u</span></span>4f60<span class="tag">\<span class="name">u</span></span>662f<span class="tag">\<span class="name">u</span></span>8c01"</div><div class="line">echo json_encode(<span class="formula">$value, 1) . "<span class="tag">\<span class="name">n</span></span>"; //对&lt;,&gt;编码，输出"hello <span class="tag">\<span class="name">u</span></span>003Cjack<span class="tag">\<span class="name">u</span></span>003E &amp;, <span class="tag">\<span class="name">u</span></span>4f60<span class="tag">\<span class="name">u</span></span>662f<span class="tag">\<span class="name">u</span></span>8c01"</span></div><div class="line"><span class="formula">echo json_encode($</span>value, 3) . "<span class="tag">\<span class="name">n</span></span>"; //对&lt;,&gt;,&amp;编码,输出"hello <span class="tag">\<span class="name">u</span></span>003Cjack<span class="tag">\<span class="name">u</span></span>003E <span class="tag">\<span class="name">u</span></span>0026, <span class="tag">\<span class="name">u</span></span>4f60<span class="tag">\<span class="name">u</span></span>662f<span class="tag">\<span class="name">u</span></span>8c01"</div><div class="line">echo json_encode(<span class="formula">$value, 259) . "<span class="tag">\<span class="name">n</span></span>";//对&lt;,&gt;,&amp;编码,不对中文编码，输出"hello <span class="tag">\<span class="name">u</span></span>003Cjack<span class="tag">\<span class="name">u</span></span>003E <span class="tag">\<span class="name">u</span></span>0026, 你是谁"</span></div></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<h2 id="json-decode"><a href="#json-decode" class="headerlink" title="json_decode"></a>json_decode</h2><h3 id="函数说明-1"><a href="#函数说明-1" class="headerlink" title="函数说明"></a>函数说明</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mixed json_decode ( <span class="built_in">string</span> $json [, bool $assoc = <span class="literal">FALSE</span> [, <span class="built_in">int</span> $depth = <span class="number">512</span> [, <span class="built_in">int</span> $options = <span class="number">0</span> ]]] )</div></pre></td></tr></table></figure>
<p>将一个json字符串转换成php中的数组</p>
<h3 id="详细参数说明-1"><a href="#详细参数说明-1" class="headerlink" title="详细参数说明"></a>详细参数说明</h3><p><strong>json</strong>: 待转换的json串<br><strong>assoc</strong>: TRUE: json串转换为数据;FALSE: 转换为对象<br><strong>depth</strong>: 用户指定的可以处理的递归深度<br><strong>options</strong>: 对json进行decode的选项</p>
<ul>
<li><p>JSON_BIGINT_AS_STRING: 将大整数转换为字符串而不是浮动，这是默认值</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$json</span> = <span class="string">'&#123;"number": 12345678901234567890&#125;'</span>;</div><div class="line"><span class="variable">$data</span> = json_decode(<span class="variable">$json</span>);</div><div class="line">var_dump(<span class="variable">$data</span>);</div><div class="line"><span class="regexp">//</span>输出</div><div class="line"><span class="regexp">//</span>object(stdClass)<span class="comment">#1 (1) &#123;</span></div><div class="line"><span class="regexp">//</span>  [<span class="string">"number"</span>]=&gt;</div><div class="line"><span class="regexp">//</span>  float(<span class="number">1.2345678901235</span>E+<span class="number">19</span>)</div><div class="line"><span class="regexp">//</span>&#125;</div><div class="line"><span class="variable">$data2</span> = json_decode(<span class="variable">$json</span>, false, <span class="number">512</span>, JSON_BIGINT_AS_STRING);</div><div class="line">var_dump(<span class="variable">$data2</span>);</div><div class="line"><span class="regexp">//</span>object(stdClass)<span class="comment">#2 (1) &#123;</span></div><div class="line"><span class="regexp">//</span>  [<span class="string">"number"</span>]=&gt;</div><div class="line"><span class="regexp">//</span>  string(<span class="number">20</span>) <span class="string">"12345678901234567890"</span></div><div class="line"><span class="regexp">//</span>&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>JSON_OBJECT_AS_ARRAY: 效果不明。。。。详见官网说明</p>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p>改方法的使用方法主要是要记住第二个参数。否则转换成的是对象而不是数据。</p>
</li>
</ul>
<h2 id="json-last-error"><a href="#json-last-error" class="headerlink" title="json_last_error"></a>json_last_error</h2><h3 id="函数说明-2"><a href="#函数说明-2" class="headerlink" title="函数说明"></a>函数说明</h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> json_last_error ( <span class="keyword">void</span> )</div><div class="line">返回最近一次json_ddecode/json_encode发生的错误</div></pre></td></tr></table></figure>
<h3 id="返回结果说明"><a href="#返回结果说明" class="headerlink" title="返回结果说明"></a>返回结果说明</h3><ul>
<li>JSON_ERROR_NONE =&gt; 0: 未发生错误</li>
<li>JSON_ERROR_DEPTH =&gt; 1: 超出最大深度 </li>
<li>JSON_ERROR_STATE_MISMATCH =&gt; 2: json格式不正确  </li>
<li>JSON_ERROR_CTRL_CHAR =&gt; 3: 控制字符错误</li>
<li>JSON_ERROR_SYNTAX =&gt; 4: 语法错误</li>
<li>JSON_ERROR_UTF8 =&gt; 5: 格式错误的UTF-8字符</li>
<li>JSON_ERROR_RECURSION =&gt; 6: 要编码的值中的一个或多个递归引用 (since 5.5.0)</li>
<li>JSON_ERROR_INF_OR_NAN =&gt; 7: 要编码的值中有一个或多个NAN或INF值 (since 5.5.0)</li>
<li>JSON_ERROR_UNSUPPORTED_TYPE =&gt; 8: 给出了一个无法编码的类型的值 (since 5.5.0)</li>
<li>JSON_ERROR_INVALID_PROPERTY_NAME =&gt; 9: 给出了一个无法编码的属性名称 (since 7.0.0)</li>
<li>JSON_ERROR_UTF16 =&gt; 10: 格式错误的UTF-16字符 (since 7.0.0)</li>
</ul>
]]></content>
      
        <categories>
            
            <category> php </category>
            
        </categories>
        
        
        <tags>
            
            <tag> php </tag>
            
            <tag> json_encode </tag>
            
            <tag> json_decode </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[使用hexo-blog-encrypt-完成博文加密]]></title>
      <url>/2018/03/18/hexo-encrypt/</url>
      <content type="html"><![CDATA[<script src="/crypto-js.js"></script><script src="/mcommon.js"></script><h3 id="encrypt-message">The password is 123456</h3><link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css"> <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap-theme.min.css"> <script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script> <script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script> <div id="security"> <div> <div class="input-group"> <input type="text" class="form-control" aria-label="Enter the password." id="pass"/> <div class="input-group-btn"> <button type="button" class="btn btn-default" onclick="decryptAES()">Decrypt</button> </div> </div> </div> </div> <div id="encrypt-blog" style="display:none"> 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 </div>]]></content>
      
        <categories>
            
            <category> hexo </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 工具 </tag>
            
            <tag> hexo </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[一些需要禁用的PHP危险函数]]></title>
      <url>/2018/03/06/some-dangerous-functions-in-php/</url>
      <content type="html"><![CDATA[<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><blockquote>
<p>本文说明了一些在php中需要禁用的函数，这些函数可能会引起服务器问题，造成不必要的麻烦。</p>
</blockquote>
<a id="more"></a>
<h2 id="有哪些？"><a href="#有哪些？" class="headerlink" title="有哪些？"></a>有哪些？</h2><ol>
<li><p><strong>phpinfo()</strong><br>功能描述：输出 PHP 环境信息以及相关的模块、WEB 环境等信息。<br>危险等级：<font color="orange">中</font></p>
</li>
<li><p><strong>passthru()</strong><br>功能描述：允许执行一个外部程序并回显输出，类似于 exec()。<br>危险等级：<font color="red">高</font></p>
</li>
<li><p><strong>exec()</strong><br>功能描述：允许执行一个外部程序（如 UNIX Shell 或 CMD 命令等）。<br>危险等级：<font color="red">高</font></p>
</li>
<li><p><strong>system()</strong><br>功能描述：允许执行一个外部程序并回显输出，类似于 passthru()。<br>危险等级：<font color="red">高</font></p>
</li>
<li><p><strong>chroot()</strong><br>功能描述：可改变当前 PHP 进程的工作根目录，仅当系统支持 CLI 模式,PHP 时才能工作，且该函数不适用于 Windows 系统。<br>危险等级：<font color="red">高</font></p>
</li>
<li><p><strong>scandir()</strong><br>功能描述：列出指定路径中的文件和目录。<br>危险等级：<font color="orange">中</font></p>
</li>
<li><p><strong>chgrp()</strong><br>功能描述：改变文件或目录所属的用户组。<br>危险等级：<font color="red">高</font></p>
</li>
<li><p><strong>chown()</strong><br>功能描述：改变文件或目录的所有者。<br>危险等级：<font color="red">高</font></p>
</li>
<li><p><strong>shell_exec()</strong><br>功能描述：通过 Shell 执行命令，并将执行结果作为字符串返回。<br>危险等级：<font color="red">高</font></p>
</li>
<li><p><strong>proc_open()</strong><br>功能描述：执行一个命令并打开文件指针用于读取以及写入。<br>危险等级：<font color="red">高</font></p>
</li>
<li><p><strong>proc_get_status()</strong><br>功能描述：获取使用 proc_open() 所打开进程的信息。<br>危险等级：<font color="red">高</font></p>
</li>
<li><p><strong>error_log()</strong><br>功能描述：将错误信息发送到指定位置（文件）。<br>安全备注：在某些版本的 PHP 中，可使用 error_log() 绕过 PHP safe mode，执行任意命令。<br>危险等级：<font color="yellow">低</font></p>
</li>
<li><p><strong>ini_alter()</strong><br>功能描述：是 ini_set() 函数的一个别名函数，功能与 ini_set() 相同。具体参见 ini_set()。<br>危险等级：<font color="red">高</font></p>
</li>
<li><p><strong>ini_set()</strong><br>功能描述：可用于修改、设置 PHP 环境配置参数。<br>危险等级：<font color="red">高</font></p>
</li>
<li><p><strong>ini_restore()</strong><br>功能描述：可用于恢复 PHP 环境配置参数到其初始值。<br>危险等级：<font color="red">高</font></p>
</li>
<li><p><strong>dl()</strong><br>功能描述：在 PHP 进行运行过程当中（而非启动时）加载一个 PHP 外部模块。<br>危险等级：<font color="red">高</font></p>
</li>
<li><p><strong>pfsockopen()</strong><br>功能描述：建立一个 Internet 或 UNIX 域的 socket 持久连接。<br>危险等级：<font color="red">高</font></p>
</li>
<li><p><strong>syslog()</strong><br>功能描述：可调用 UNIX 系统的系统层 syslog() 函数。<br>危险等级：<font color="orange">中</font></p>
</li>
<li><p><strong>readlink()</strong><br>功能描述：返回符号连接指向的目标文件内容。<br>危险等级：<font color="orange">中</font></p>
</li>
<li><p><strong>symlink()</strong><br>功能描述：在 UNIX 系统中建立一个符号链接。<br>危险等级：<font color="red">高</font></p>
</li>
<li><p><strong>popen()</strong><br>功能描述：可通过 popen() 的参数传递一条命令，并对 popen() 所打开的文件进行执行。<br>危险等级: <font color="red">高</font></p>
</li>
<li><p><strong>stream_socket_server()</strong><br>功能描述：建立一个 Internet 或 UNIX 服务器连接。<br>危险等级：<font color="orange">中</font></p>
</li>
<li><p><strong>putenv()</strong><br>功能描述：用于在 PHP 运行时改变系统字符集环境。在低于 5.2.6 版本的 PHP 中，可利用该函数修改系统字符集环境后，利用 sendmail 指令发送特殊参数执行系统 SHELL 命令。<br>危险等级：<font color="red">高</font></p>
</li>
</ol>
<h2 id="禁用方法"><a href="#禁用方法" class="headerlink" title="禁用方法"></a>禁用方法</h2><ol>
<li>打开/etc/php.ini文件，</li>
<li>查找到 disable_functions ，添加需禁用的函数名，如下：<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">phpinfo,<span class="keyword">eval</span>,passthru,<span class="keyword">exec</span>,<span class="keyword">system</span>,<span class="keyword">chroot</span>,scandir,chgrp,<span class="keyword">chown</span>,shell_exec,proc_open,proc_get_status,ini_alter,ini_alter,ini_restore,dl,pfsockopen,openlog,syslog,<span class="keyword">readlink</span>,<span class="keyword">symlink</span>,popepassthru,stream_socket_server,fsocket,fsockopen</div></pre></td></tr></table></figure></li>
</ol>
]]></content>
      
        <categories>
            
            <category> php </category>
            
        </categories>
        
        
        <tags>
            
            <tag> php </tag>
            
            <tag> code </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[【译文】mysql8.0:退出对查询缓存的支持]]></title>
      <url>/2017/10/20/mysql-8-0-retiring-support-for-the-query-cache/</url>
      <content type="html"><![CDATA[<p><strong><em>原文链接：<a href="http://mysqlserverteam.com/mysql-8-0-retiring-support-for-the-query-cache/" target="_blank" rel="external">http://mysqlserverteam.com/mysql-8-0-retiring-support-for-the-query-cache/</a></em></strong></p>
<p><strong><em>Author:Morgan Tocker(the Product Manager for the MySQL Server)</em></strong></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>正如Rene昨天在<a href="http://proxysql.com/blog/scaling-with-proxysql-query-cache" target="_blank" rel="external">ProxySQL</a>博客上写道：</p>
<blockquote>
<p>尽管MySQL查询缓存旨在提高性能，但它具有严重的可扩展性问题，并且很容易成为严重的瓶颈。</p>
</blockquote>
<p>这确实是我们在MySQL团队观察一段时间后得到的结论。在我们了解今天的文章之前，让我先来介绍一下查询缓存。<br><a id="more"></a></p>
<h2 id="查询缓存简介"><a href="#查询缓存简介" class="headerlink" title="查询缓存简介"></a>查询缓存简介</h2><p>MySQL查询缓存是查询结果缓存。他会将以<strong>SEL</strong>开头的查询语句与一个散列表进行比较，如果有匹配则返回上一次执行查询的结果。这里还有一些限制：</p>
<ul>
<li>查询必须匹配字节级的匹配（查询缓存避免解析）</li>
<li>使用<a href="https://dev.mysql.com/doc/refman/5.7/en/query-cache-operation.html" target="_blank" rel="external">非确定性特征</a>将导致查询不被缓存（包括临时表，用户变量，RAND（），NOW（）和UDF））</li>
<li>查询缓存旨在不提供过时的结果。对基础表的任何修改都会导致所有缓存对于这些表无效。</li>
<li>如果缓存用在InnoDB引擎中，会有一些限制（对于MVCC，因为您打开了一个事务，“缓存”可能不会得到用户预期中的数据）</li>
</ul>
<h2 id="最佳案例"><a href="#最佳案例" class="headerlink" title="最佳案例"></a>最佳案例</h2><p>正如我几年前在个人博客上写的：</p>
<blockquote>
<p>查询缓存的理想使用场景往往在很大程度上是只读的，这个场景下，通过非常大的代价去检查数百万行数据，但是指返回很少的结果 一个假设出的例子是可能有一个复杂的查询来得到一个网页上的表单中的下拉列表的值，在这种情况下，查询缓存可以掩盖由于缺少的索引引起的查询性能问题，这对新手用户有帮助。</p>
</blockquote>
<p>这个观点在今天仍然适用，但是我认为重要的是还要指出，我们现在已经有很多DBA工具的对这些性能有所改善：</p>
<ul>
<li>在MySQL服务器中，我们现在可以重写查询以插入提示（或通过其他修改来提高性能）</li>
<li>我们有如ProxySQL这样的第三方工具，可以充当中间人查询缓存。 ProxySQL还支持缓存的TTL，它在我之前提供的示例中可以正常工作（构建下拉列表的值列表）。</li>
</ul>
<h2 id="查询缓存的限制"><a href="#查询缓存的限制" class="headerlink" title="查询缓存的限制"></a>查询缓存的限制</h2><p>自从MySQL 5.6（2013）以来，查询缓存已被禁用，因为它已知在多核机器上不能与高吞吐量工作负载的规模相比较。 Rene昨天在他的帖子中证实了这一点，而且这个问题之前也曾被<a href="https://www.flamingspork.com/blog/2014/06/05/performance-impact-of-mysql-query-cache-on-modern-hardware/" target="_blank" rel="external">Stewart Smith</a>和<a href="https://dom.as/tech/query-cache-tuner/" target="_blank" rel="external">Domas Mituzas</a>（更新：<a href="http://blog.koehntopp.info/index.php/1844-good-riddance-to-the-query-cache/" target="_blank" rel="external">Kristian Koehntopp</a>）提及。</p>
<p>假设可扩展性可以提高，查询缓存的限制因素在于，只有查询命中了的缓存才能看到改进; 它不太可能提高性能的可预测性。 对于面向用户的系统，降低性能的可变性通常比提高峰值吞吐量更重要：<br><img src="http://mysqlserverteam.com/wp-content/uploads/2017/05/Predictability-SIGMOD2017-768x576.jpg" alt="现有DBMS系统性能的预测"><br><img src="http://mysqlserverteam.com/wp-content/uploads/2017/05/Predictability-SIGMOD2017-2-768x576.jpg" alt="为什么性能可预测性很重要"><br><strong><em><a href="http://web.eecs.umich.edu/~mozafari/php/data/uploads/Predictability-SIGMOD2017.pdf" target="_blank" rel="external">数据来源</a></em></strong></p>
<h2 id="决定删除对查询缓存的支持"><a href="#决定删除对查询缓存的支持" class="headerlink" title="决定删除对查询缓存的支持"></a>决定删除对查询缓存的支持</h2><p>我们赞同University of Michigan, Ann Arbor大学的Jiamin Huang，Barzan Mozafari，Grant Schoenebeck，Thomas F. Wenisch的<a href="https://web.eecs.umich.edu/~mozafari/php/data/uploads/sigmod_2017_predictability.pdf" target="_blank" rel="external">研究成果</a>。 我们考虑了两种方案：一个是我们可以对查询缓存进行哪些改进的方案，另一个是我们可以做出哪些改进，从而为所有工作负载提供改进。</p>
<p>虽然这些选择本身是正交的，但工程资源是有限的。也就是说，我们要改变战略，去把资源投资到能够普遍适用于所有工作负载的改进上来。</p>
<p>我们也同意<a href="http://proxysql.com/blog/scaling-with-proxysql-query-cache" target="_blank" rel="external">Rene的结论</a>，即缓存在靠近客户端时提供了最大的好处<br><img src="http://mysqlserverteam.com/wp-content/uploads/2017/05/QC2.png" alt="缓存性能的表现"><br><strong><em>将缓存移到客户端时，“Client + 2x ProxySQL”结果显示性能提升了5.2倍。</em></strong></p>
<h2 id="现有用户的升级路径"><a href="#现有用户的升级路径" class="headerlink" title="现有用户的升级路径"></a>现有用户的升级路径</h2><p>根据当前的提示说明，查询缓存在MySQL 5.7一下版本仍然会继续得到支持。 但MySQL 8.0不再支持查询缓存，用户升级将被鼓励使用服务器端查询重写或ProxySQL作为中间缓存</p>
<p>我们预计这种变化只会影响到少数用户，但如果您关心此问题，请联系并联系！</p>
<p>感谢您使用MySQL！！</p>
]]></content>
      
        <categories>
            
            <category> mysql </category>
            
        </categories>
        
        
        <tags>
            
            <tag> mysql </tag>
            
            <tag> 数据库 </tag>
            
            <tag> 查询缓存 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[数据库查询缓存]]></title>
      <url>/2017/10/20/mysql-query-cache/</url>
      <content type="html"><![CDATA[<h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>起因是近期，集客中的数据又出现了查询极慢的情况。单表1100W数据,在进行count(*)查询的时候,查询性能极差，按照特定条件的查询(已加索引)，查询出月500W数据的时候，大约耗时18s多。<br>可能解决方案:</p>
<ol>
<li>存储引擎修改</li>
<li>查询语句优化</li>
<li>离线预查(此方案结合业务场景)<br>详见此文：[mysql千万级数据count性能优化]</li>
</ol>
<p>在解决的过程中顺道看了下查询缓存的问题，线上库竟然没有开启查询缓存。特此做了些记录。<br><a id="more"></a></p>
<h2 id="查询缓存原理"><a href="#查询缓存原理" class="headerlink" title="查询缓存原理"></a>查询缓存原理</h2><h3 id="查询缓存的实现原理"><a href="#查询缓存的实现原理" class="headerlink" title="查询缓存的实现原理"></a>查询缓存的实现原理</h3><h3 id="查询缓存的写入与过期"><a href="#查询缓存的写入与过期" class="headerlink" title="查询缓存的写入与过期"></a>查询缓存的写入与过期</h3><h2 id="查询缓存相关参数说明"><a href="#查询缓存相关参数说明" class="headerlink" title="查询缓存相关参数说明"></a>查询缓存相关参数说明</h2><h3 id="查询缓存参数"><a href="#查询缓存参数" class="headerlink" title="查询缓存参数"></a>查询缓存参数</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show status like “%Qcache%”;</div><div class="line"></div><div class="line">+-------------------------+---------+</div><div class="line">|<span class="string"> Variable_name           </span>|<span class="string"> Value   </span>|</div><div class="line">+-------------------------+---------+</div><div class="line">|<span class="string"> Qcache_free_blocks      </span>|<span class="string"> 1639    </span>|</div><div class="line">|<span class="string"> Qcache_free_memory      </span>|<span class="string"> 5579448 </span>|</div><div class="line">|<span class="string"> Qcache_hits             </span>|<span class="string"> 1464051 </span>|</div><div class="line">|<span class="string"> Qcache_inserts          </span>|<span class="string"> 2442792 </span>|</div><div class="line">|<span class="string"> Qcache_lowmem_prunes    </span>|<span class="string"> 1910628 </span>|</div><div class="line">|<span class="string"> Qcache_not_cached       </span>|<span class="string"> 447381  </span>|</div><div class="line">|<span class="string"> Qcache_queries_in_cache </span>|<span class="string"> 8707    </span>|</div><div class="line">|<span class="string"> Qcache_total_blocks     </span>|<span class="string"> 19402   </span>|</div><div class="line">+-------------------------+---------+</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>变量名称</th>
<th>中文</th>
<th>英文</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>Qcache_free_blocks</td>
<td>查询缓存中空闲内存块数量</td>
<td>The number of free memory blocks in the query cache</td>
<td></td>
</tr>
<tr>
<td>Qcache_free_memory</td>
<td>查询缓存中空闲内存大小</td>
<td>The amount of free memory for the query cache.</td>
<td>单位B</td>
</tr>
<tr>
<td>Qcache_hits</td>
<td>查询缓存命中数</td>
<td>The number of query cache hits</td>
<td></td>
</tr>
<tr>
<td>Qcache_inserts</td>
<td>加入查询缓存的语句数量</td>
<td>The number of queries added to the query cache.</td>
<td></td>
</tr>
<tr>
<td>Qcache_lowmem_prunes</td>
<td>由于内存不足删除的查询语句数</td>
<td>The number of queries that were deleted from the query cache because of low memory</td>
<td>这个数字的持续增长说明内存不足或碎片严重</td>
</tr>
<tr>
<td>Qcache_not_cached</td>
<td>没有被缓存的查询语句数</td>
<td>The number of noncached queries</td>
<td></td>
</tr>
<tr>
<td>Qcache_queries_in_cache</td>
<td>查询缓存中的语句数</td>
<td>The number of queries registered in the query cache</td>
<td></td>
</tr>
<tr>
<td>Qcache_total_blocks</td>
<td>查询缓存的块数</td>
<td>The total number of blocks in the query cache</td>
</tr>
</tbody>
</table>
<p><strong>备注：所有上述参数都已经在mysql5.7.20弃用,在8.0删除,使用时，请确认mysql版本</strong></p>
<h3 id="查询缓存配置参数"><a href="#查询缓存配置参数" class="headerlink" title="查询缓存配置参数"></a>查询缓存配置参数</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show variables like <span class="emphasis">'query_cache%'</span>;</div><div class="line"><span class="code">+------------------------------+</span>----------+</div><div class="line">| Variable<span class="emphasis">_name                | Value    |</span></div><div class="line"><span class="emphasis">+------------------------------+----------+</span></div><div class="line"><span class="emphasis">| query_</span>cache<span class="emphasis">_limit            | 1048576  |</span></div><div class="line"><span class="emphasis">| query_</span>cache<span class="emphasis">_min_</span>res<span class="emphasis">_unit     | 4096     |</span></div><div class="line"><span class="emphasis">| query_</span>cache<span class="emphasis">_size             | 16777216 |</span></div><div class="line"><span class="emphasis">| query_</span>cache<span class="emphasis">_type             | ON       |</span></div><div class="line"><span class="emphasis">| query_</span>cache<span class="emphasis">_wlock_</span>invalidate | OFF      |</div><div class="line"><span class="code">+------------------------------+</span>----------+</div><div class="line">5 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>变量名称</th>
<th>中文</th>
<th>英文</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>query_cache_limit</td>
<td>查询结果最大限制，大于这个值的不缓存</td>
<td>Do not cache results that are larger than this number of bytes. The default value is 1MB.</td>
<td>默认1MB</td>
</tr>
<tr>
<td>query_cache_min_res_unit</td>
<td>查询缓存中分配的块的最小大小</td>
<td>The minimum size (in bytes) for blocks allocated by the query cache</td>
<td>字节为单位，默认4096B</td>
</tr>
<tr>
<td>query_cache_size</td>
<td>用于缓存查询结果的缓存大小</td>
<td>The amount of memory allocated for caching query results.</td>
<td>默认1M</td>
</tr>
<tr>
<td>query_cache_type</td>
<td>查询缓存的类型0/OFF：不进行查询缓存；1：缓存除SELECT SQL_NO_CACHE开头的所有可缓存查询结果；2：值缓存以SELECT SQL_CACHE开头的可缓存查询</td>
<td>Set the query cache type</td>
<td>默认OFF,如果选择OFF，并不会清空查询缓存大小，如果需要，需设置query_cache_size=0</td>
</tr>
<tr>
<td>query_cache_wlock_invalidate</td>
<td>针对MyISAM引擎表，对表的请求进行限制</td>
<td>Normally, when one client acquires a WRITE lock on a MyISAM table, other clients are not blocked from issuing statements that read from the table if the query results are present in the query cache. Setting this variable to 1 causes acquisition of a WRITE lock for a table to invalidate any queries in the query cache that refer to the table. This forces other clients that attempt to access the table to wait while the lock is in effect</td>
<td>具体解释参见官方说明</td>
</tr>
</tbody>
</table>
<p><strong>备注：所有上述参数都已经在mysql5.7.20弃用,在8.0删除,使用时，请确认mysql版本</strong></p>
<h2 id="参考文件"><a href="#参考文件" class="headerlink" title="参考文件"></a>参考文件</h2><ol>
<li><a href="https://dev.mysql.com/doc/refman/5.7/en/server-status-variables.html" target="_blank" rel="external">5.1.7 Server Status Variables</a></li>
<li><a href="https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html" target="_blank" rel="external">5.1.5 Server System Variables</a></li>
<li><a href="http://database.51cto.com/art/201010/229956.htm" target="_blank" rel="external">MySQL查询缓存变量</a></li>
<li><a href="https://www.oschina.net/question/554525_132387" target="_blank" rel="external">MYSQL会把查询的结果缓存多久?一个考验人的技术问题</a></li>
<li><a href="/2017/10/20/mysql-8-0-retiring-support-for-the-query-cache/">[译文]mysql8.0:退出对查询缓存的支持</a></li>
</ol>
]]></content>
      
        <categories>
            
            <category> mysql </category>
            
        </categories>
        
        
        <tags>
            
            <tag> mysql </tag>
            
            <tag> 数据库 </tag>
            
            <tag> 查询缓存 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[单例模式]]></title>
      <url>/2017/09/23/design-patterns-singleton/</url>
      <content type="html"><![CDATA[<h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><blockquote>
<p>保证一个类仅有一个实例，并提供访问它的全局访问点</p>
</blockquote>
<a id="more"></a>
<h2 id="适用性"><a href="#适用性" class="headerlink" title="适用性"></a>适用性</h2><blockquote>
<ul>
<li>当类只能有一个实例，而且客户可以从一个众所周知的访问点访问它</li>
<li>当这个唯一的实例应该是通过子类化可扩展的，并且客户应该无需更改代码就能使用一个扩展的实例时</li>
</ul>
</blockquote>
<p>我的理解：<br>单例模式主要用于只能创建一个对象实例的场景，如db类，文件类，cache类这些，防止过多的连接造成资源的浪费。</p>
<h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><p><img src="http://www.phppan.com/wp-content/uploads/2010/06/Singleton.jpg" alt="singleton"></p>
<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">testsingleton();</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">singleton</span></span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> $object = <span class="keyword">null</span>;</div><div class="line">  </div><div class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">print</span> <span class="string">"create object\n"</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getInstance</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">self</span>::$object == <span class="keyword">null</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">self</span>::$object = <span class="keyword">new</span> singleton();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">self</span>::$object;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span><span class="params">()</span></span>&#123;&#125;</div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">testsingleton</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    $object = singleton::getInstance();</div><div class="line"></div><div class="line">    $object2 = singleton::getInstance();</div><div class="line"></div><div class="line">    <span class="keyword">echo</span> $object === $object2 ? <span class="string">"one object"</span> : <span class="string">'tow object'</span>;</div><div class="line"></div><div class="line">    <span class="keyword">echo</span> PHP_EOL;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="明显特征"><a href="#明显特征" class="headerlink" title="明显特征"></a>明显特征</h2><p>1公(getInstance)4私(object,__construct,__clone,__wakeup)</p>
<ol>
<li>定义了一个public类型的用来返回对象的方法,只能通过该方法生成对象</li>
<li>定义了一个人private的私有属性，代表具体的类对象，只能通过public方法获得</li>
<li>非public的构造函数，不可直接new对象，如果__construct是共有的，就意味着可以使用new创建对象，这样会产生不同的对象</li>
<li>为了防止使用<strong>clone</strong>复制对象，使用<strong>unserialize</strong>反序列化得到对象,需要将<strong>clone和</strong>wakeup对象重新定义为两个什么都不做的私有方法。</li>
</ol>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>1.<a href="https://www.awaimai.com/patterns/singleton" target="_blank" rel="external">单例模式</a><br>2.<a href="http://blog.gaoyuan.xyz/2014/04/26/singleton-pattern-in-php/" target="_blank" rel="external">Php中的单例模式面面观</a></p>
]]></content>
      
        <categories>
            
            <category> 代码的艺术 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> design patterns </tag>
            
            <tag> 单例模式 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[五个设计模式]]></title>
      <url>/2017/08/26/five-design-patterns/</url>
      <content type="html"><![CDATA[<h2 id="说在前边"><a href="#说在前边" class="headerlink" title="说在前边"></a>说在前边</h2><blockquote>
<p>设计模式是我曾经拿起又放下的东西，经典的<strong><a href="https://book.douban.com/subject/1052241/" target="_blank" rel="external">设计模式</a></strong>那本书也是看过的,但无奈却没有看完。当了两年多的程序员，回想一下，自己对设计模式的理解竟然还是如此的不堪。</p>
<p>随着年龄的增长，工作年限的增加，越发觉得知识的不足与停滞。所以是时候真的真的该慢慢的，默默的学习一些东西了，不然，焦躁的情绪就无处发泄。<br>也许，静静的学习，成长，才能帮助我安静下来，沉淀知识，获得成长。</p>
</blockquote>
<a id="more"></a>
<blockquote>
<p>本次主要会重点记录自己重新学习五种主要设计模式的一些心得，做个记录。一来，帮助自己增强记忆学习；二来做个记录，方便后边回顾。</p>
<p>为什么选择这几个模式呢，只能说，就我所知，他们被说的更多，被用的更多。</p>
</blockquote>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><h3 id="创建型"><a href="#创建型" class="headerlink" title="创建型"></a>创建型</h3><ul>
<li>工厂模式<ul>
<li><a href="/2017/08/26/design-patterns-easyFactory/">简单工厂模式</a></li>
<li><a href="/2018/06/20/design-patterns-factory/">工厂模式</a></li>
<li><a href="/2018/06/20/design-patterns-abstractfactory/">抽象工厂模式</a></li>
<li><a href="/2018/06/20/design-patterns-diff-of-factory/">三种工厂模式的区别</a></li>
</ul>
</li>
<li><a href="/2017/09/23/design-patterns-singleton/">单例模式</a></li>
</ul>
<h3 id="结构型"><a href="#结构型" class="headerlink" title="结构型"></a>结构型</h3><ul>
<li>适配器模式</li>
</ul>
<h3 id="行为型"><a href="#行为型" class="headerlink" title="行为型"></a>行为型</h3><ul>
<li>策略模式</li>
<li>观察者模式</li>
</ul>
]]></content>
      
        <categories>
            
            <category> 代码的艺术 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> design patterns </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[简单工厂模式]]></title>
      <url>/2017/08/26/design-patterns-easyFactory/</url>
      <content type="html"><![CDATA[<p>工厂模式也是创建型模式，常说的工厂模式主要包含三种，简单工厂模式，工厂模式，抽象工厂模式，三种可以理解为一个逐步抽象的过程。<br>后续分别会对三种工厂模式分别做简单介绍，本文首先介绍简单工厂模式</p>
<h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><a id="more"></a>
<h2 id="适用性"><a href="#适用性" class="headerlink" title="适用性"></a>适用性</h2><h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><p><img src="http://dl2.iteye.com/upload/attachment/0099/4166/37e2d83e-06e8-38fa-bc1a-ec9ced7a61e0.jpg" alt="simple_factory"><br>从图上可以看出，简单工厂模式主要有三个元素，1、client(调用工厂)；2、简单工厂类(生成者)；3、产品类<br>其中简单工厂类根据client传入的产品需求来生产。所有的产品类都有统一的特征，每个具体的产品都是是产品接口实现</p>
<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//工厂类</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">fruitFactory</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">createFruit</span><span class="params">($fruitName)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        $className = ucfirst($fruitName);</div><div class="line">        <span class="keyword">if</span>(class_exists($className))</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> $className;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span></div><div class="line">        &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="keyword">Exception</span>(<span class="string">'we can not create fruit ['</span> . $fruitName . <span class="string">']'</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//产品类</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Fruit</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFruit</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Apple</span> <span class="keyword">implements</span> <span class="title">Fruit</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFruit</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">echo</span> <span class="string">'I am Apple'</span> . PHP_EOL;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pear</span> <span class="keyword">implements</span> <span class="title">Fruit</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFruit</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">echo</span> <span class="string">'I am Pear'</span> . PHP_EOL;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Banana</span> <span class="keyword">implements</span> <span class="title">Fruit</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFruit</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">echo</span> <span class="string">'I am Banana'</span> . PHP_EOL;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//client</span></div><div class="line">$fruitName = <span class="keyword">isset</span>($argv[<span class="number">1</span>]) ? $argv[<span class="number">1</span>] : <span class="string">""</span>;</div><div class="line"></div><div class="line"><span class="keyword">try</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>($fruitName))</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="keyword">Exception</span>(<span class="string">"must choose fruit"</span>);</div><div class="line">    &#125;</div><div class="line">    $fruit = fruitFactory::createFruit($fruitName);</div><div class="line">    $fruit-&gt;getFruit();</div><div class="line">&#125;</div><div class="line"><span class="keyword">catch</span>(<span class="keyword">Exception</span> $e)</div><div class="line">&#123;</div><div class="line">    <span class="keyword">echo</span> $e-&gt;getMessage() . PHP_EOL;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="明显特征"><a href="#明显特征" class="headerlink" title="明显特征"></a>明显特征</h2><ol>
<li>通过客户端输入参数给工厂来创建产品</li>
<li>每种产品都是一个抽象产品的实现（也可以是抽象类的继承）</li>
</ol>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>1.<a href="http://zyjustin9.iteye.com/blog/2094960" target="_blank" rel="external">设计模式：简单工厂、工厂方法、抽象工厂之小结与区别</a><br>2.<a href="https://www.awaimai.com/patterns/simple-factory" target="_blank" rel="external">简单工厂模式</a></p>
]]></content>
      
        <categories>
            
            <category> 代码的艺术 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> design patterns </tag>
            
            <tag> 工厂模式 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[linux下忘记mysql的root密码怎么办]]></title>
      <url>/2017/08/17/forget-mysql-password/</url>
      <content type="html"><![CDATA[<h2 id="修改MySql的登录设置"><a href="#修改MySql的登录设置" class="headerlink" title="修改MySql的登录设置"></a>修改MySql的登录设置</h2><p><code>vi /etc/my.cnf</code></p>
<p>在[mysqld]的段中加上一句：<strong><em>skip-grant-tables</em></strong><br>Example:<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[mysqld]</div><div class="line">port                    = 3306</div><div class="line">socket                  = /tmp/mysql.sock</div><div class="line">skip-grant-tables</div></pre></td></tr></table></figure></p>
<p>【备注】：此操作后数据库不需要密码即可登录，请确认网络环境安全后进行操作<br><a id="more"></a></p>
<h2 id="重启mysql"><a href="#重启mysql" class="headerlink" title="重启mysql"></a>重启mysql</h2><p>此命令前提是linux已配置可使用此种方式重启mysql<br><figure class="highlight gams"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># service mysql restart</div><div class="line"><span class="function"><span class="title">Shutting</span></span> down MySQL.. SUCCESS!</div><div class="line"><span class="function"><span class="title">Starting</span></span> MySQL.. SUCCESS!</div></pre></td></tr></table></figure></p>
<h2 id="登录mysql并修改root密码"><a href="#登录mysql并修改root密码" class="headerlink" title="登录mysql并修改root密码"></a>登录mysql并修改root密码</h2><h3 id="登录mysql"><a href="#登录mysql" class="headerlink" title="登录mysql"></a>登录mysql</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">mysql -uroot</span></div></pre></td></tr></table></figure>
<h3 id="修改root用户密码"><a href="#修改root用户密码" class="headerlink" title="修改root用户密码"></a>修改root用户密码</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mysql&gt; use user;</div><div class="line">mysql&gt; update<span class="built_in"> user </span><span class="builtin-name">set</span> Password = password(<span class="string">"new_password"</span>) where <span class="attribute">User</span>=<span class="string">"root"</span>;</div><div class="line">mysql&gt; quit;</div><div class="line">Bye</div></pre></td></tr></table></figure>
<h2 id="将my-cnf配置改回来"><a href="#将my-cnf配置改回来" class="headerlink" title="将my.cnf配置改回来"></a>将my.cnf配置改回来</h2><h2 id="重启mysql-1"><a href="#重启mysql-1" class="headerlink" title="重启mysql"></a>重启mysql</h2><hr>
<p>接下来就可以使用新密码登录了</p>
]]></content>
      
        <categories>
            
            <category> mysql </category>
            
        </categories>
        
        
        <tags>
            
            <tag> mysql </tag>
            
            <tag> 数据库 </tag>
            
            <tag> Linux </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[保证分布式系统数据一致性的6种方案]]></title>
      <url>/2017/08/10/6-method-ensure-consistency/</url>
      <content type="html"><![CDATA[<p>来自：<a href="http://weibo.com/archnotes" target="_blank" rel="external">@高可用架构</a>​​​​<br>原文链接：<a href="http://weibo.com/ttarticle/p/show?id=2309403965965003062676#_0" target="_blank" rel="external">http://weibo.com/ttarticle/p/show?id=2309403965965003062676#_0</a></p>
<blockquote>
<p>编者按：本文由「高可用架构后花园」群讨论整理而成。<br>有人的地方，就有江湖<br>有江湖的地方，就有纷争</p>
</blockquote>
<a id="more"></a>
<h2 id="问题的起源"><a href="#问题的起源" class="headerlink" title="问题的起源"></a>问题的起源</h2><p>在电商等业务中，系统一般由多个独立的服务组成，如何解决分布式调用时候数据的一致性？ </p>
<p>具体业务场景如下，比如一个业务操作，如果同时调用服务 A、B、C，需要满足要么同时成功；要么同时失败。A、B、C 可能是多个不同部门开发、部署在不同服务器上的远程服务。</p>
<p>在分布式系统来说，如果不想牺牲一致性，CAP 理论告诉我们只能放弃可用性，这显然不能接受。为了便于讨论问题，先简单介绍下数据一致性的基础理论。</p>
<ul>
<li><p>强一致</p>
<blockquote>
<p>当更新操作完成之后，任何多个后续进程或者线程的访问都会返回最新的更新过的值。这种是对用户最友好的，就是用户上一次写什么，下一次就保证能读到什么。根据 CAP 理论，这种实现需要牺牲可用性。</p>
</blockquote>
</li>
<li><p>弱一致性</p>
<blockquote>
<p>系统并不保证续进程或者线程的访问都会返回最新的更新过的值。系统在数据写入成功之后，不承诺立即可以读到最新写入的值，也不会具体的承诺多久之后可以读到</p>
</blockquote>
</li>
<li><p>最终一致性</p>
<blockquote>
<p>弱一致性的特定形式。系统保证在没有后续更新的前提下，系统最终返回上一次更新操作的值。在没有故障发生的前提下，不一致窗口的时间主要受通信延迟，系统负载和复制副本的个数影响。DNS 是一个典型的最终一致性系统。</p>
</blockquote>
</li>
</ul>
<p>在工程实践上，为了保障系统的可用性，互联网系统大多将强一致性需求转换成最终一致性的需求，并通过系统执行幂等性的保证，保证数据的最终一致性。但在电商等场景中，对于数据一致性的解决方法和常见的互联网系统（如 MySQL 主从同步）又有一定区别，群友的讨论分成以下 6 种解决方案。</p>
<h2 id="规避分布式事务——业务整合"><a href="#规避分布式事务——业务整合" class="headerlink" title="规避分布式事务——业务整合"></a>规避分布式事务——业务整合</h2><p>业务整合方案主要采用将接口整合到本地执行的方法。拿问题场景来说，则可以将服务 A、B、C 整合为一个服务 D 给业务，这个服务 D 再通过转换为本地事务的方式，比如服务 D 包含本地服务和服务 E，而服务 E 是本地服务 A ~ C 的整合。</p>
<p><strong>优点</strong>：解决（规避）了分布式事务。</p>
<p><strong>缺点</strong>：显而易见，把本来规划拆分好的业务，又耦合到了一起，业务职责不清晰，不利于维护。</p>
<p>由于这个方法存在明显缺点，通常不建议使用。</p>
<h2 id="经典方案-eBay-模式"><a href="#经典方案-eBay-模式" class="headerlink" title="经典方案 - eBay 模式"></a>经典方案 - eBay 模式</h2><p>此方案的核心是将需要分布式处理的任务通过消息日志的方式来异步执行。消息日志可以存储到本地文本、数据库或消息队列，再通过业务规则自动或人工发起重试。人工重试更多的是应用于支付场景，通过对账系统对事后问题的处理。</p>
<p><strong>消息日志方案的核心是保证服务接口的幂等性。</strong></p>
<p>考虑到网络通讯失败、数据丢包等原因，如果接口不能保证幂等性，数据的唯一性将很难保证。</p>
<p>eBay 方式的主要思路如下。</p>
<p><strong>Base：一种 Acid 的替代方案</strong></p>
<p>此方案是 eBay 的架构师 Dan Pritchett 在 2008 年发表给 ACM 的文章，是一篇解释 BASE 原则，或者说最终一致性的经典文章。文中讨论了 BASE 与 ACID 原则在保证数据一致性的基本差异。</p>
<p>如果 ACID 为分区的数据库提供一致性的选择，那么如何实现可用性呢？答案是</p>
<p><strong>BASE (basically available, soft state, eventually consistent)</strong></p>
<p>BASE 的可用性是通过支持局部故障而不是系统全局故障来实现的。下面是一个简单的例子：如果将用户分区在 5 个数据库服务器上，BASE 设计鼓励类似的处理方式，一个用户数据库的故障只影响这台特定主机那 20% 的用户。这里不涉及任何魔法，不过它确实可以带来更高的可感知的系统可用性。</p>
<p>文章中描述了一个最常见的场景，如果产生了一笔交易，需要在交易表增加记录，同时还要修改用户表的金额。这两个表属于不同的远程服务，所以就涉及到分布式事务一致性的问题。</p>
<p><img src="https://ww1.sinaimg.cn/large/006kbv1Jgw1f31xaggg0bj30cq09mq3h.jpg" alt="Alt text"></p>
<p>文中提出了一个经典的解决方法，将主要修改操作以及更新用户表的消息放在一个本地事务来完成。同时为了避免重复消费用户表消息带来的问题，达到多次重试的幂等性，增加一个<strong>更新记录表 updates_applied</strong> 来记录已经处理过的消息。</p>
<p><img src="https://ww4.sinaimg.cn/large/006kbv1Jgw1f31xaq6ex2j30ct082wev.jpg" alt="Alt text"></p>
<p>系统的执行伪代码如下</p>
<p><img src="https://ww3.sinaimg.cn/large/006kbv1Jgw1f31xa82oomj30j30iawgc.jpg" alt="code"></p>
<h2 id="去哪儿网分布式事务方案"><a href="#去哪儿网分布式事务方案" class="headerlink" title="去哪儿网分布式事务方案"></a>去哪儿网分布式事务方案</h2><p>随着业务规模不断地扩大，电商网站一般都要面临拆分之路。就是将原来一个单体应用拆分成多个不同职责的子系统。比如以前可能将面向用户、客户和运营的功能都放在一个系统里，现在拆分为订单中心、代理商管理、运营系统、报价中心、库存管理等多个子系统。</p>
<p><strong>拆分首先要面临的是什么呢？</strong></p>
<p>最开始的单体应用所有功能都在一起，存储也在一起。比如运营要取消某个订单，那直接去更新订单表状态，然后更新库存表就 ok 了。因为是单体应用，库在一起，这些都可以在一个事务里，由关系数据库来保证一致性。</p>
<p>但拆分之后就不同了，不同的子系统都有自己的存储。比如订单中心就只管理自己的订单库，而库存管理也有自己的库。那么运营系统取消订单的时候就是通过接口调用等方式来调用订单中心和库存管理的服务了，而不是直接去操作库。这就涉及一个『分布式事务』的问题。</p>
<p>分布式事务有两种解决方式</p>
<h3 id="优先使用异步消息。"><a href="#优先使用异步消息。" class="headerlink" title="优先使用异步消息。"></a>优先使用异步消息。</h3><p>上文已经说过，使用异步消息 Consumer 端需要实现幂等。</p>
<p>幂等有两种方式，一种方式是业务逻辑保证幂等。比如接到支付成功的消息订单状态变成支付完成，如果当前状态是支付完成，则再收到一个支付成功的消息则说明消息重复了，直接作为消息成功处理。</p>
<p>另外一种方式如果业务逻辑无法保证幂等，则要增加一个去重表或者类似的实现。对于 producer 端在业务数据库的同实例上放一个消息库，发消息和业务操作在同一个本地事务里。发消息的时候消息并不立即发出，而是向消息库插入一条消息记录，然后在事务提交的时候再异步将消息发出，发送消息如果成功则将消息库里的消息删除，如果遇到消息队列服务异常或网络问题，消息没有成功发出那么消息就留在这里了，会有另外一个服务不断地将这些消息扫出重新发送。</p>
<h3 id="有的业务不适合异步消息的方式，事务的各个参与方都需要同步的得到结果。"><a href="#有的业务不适合异步消息的方式，事务的各个参与方都需要同步的得到结果。" class="headerlink" title="有的业务不适合异步消息的方式，事务的各个参与方都需要同步的得到结果。"></a>有的业务不适合异步消息的方式，事务的各个参与方都需要同步的得到结果。</h3><p>这种情况的实现方式其实和上面类似，每个参与方的本地业务库的同实例上面放一个事务记录库。</p>
<p>比如 A 同步调用 B，C。A 本地事务成功的时候更新本地事务记录状态，B 和 C 同样。如果有一次 A 调用 B 失败了，这个失败可能是 B 真的失败了，也可能是调用超时，实际 B 成功。则由一个中心服务对比三方的事务记录表，做一个最终决定。假设现在三方的事务记录是 A 成功，B 失败，C 成功。那么最终决定有两种方式，根据具体场景：</p>
<ol>
<li>重试 B，直到 B 成功，事务记录表里记录了各项调用参数等信息；</li>
<li>执行 A 和 B 的补偿操作(一种可行的补偿方式是回滚)。</li>
</ol>
<p>对 b 场景做一个特殊说明：比如 B 是扣库存服务，在第一次调用的时候因为某种原因失败了，但是重试的时候库存已经变为 0，无法重试成功，这个时候只有回滚 A 和 C 了。</p>
<p>那么可能有人觉得在业务库的同实例里放消息库或事务记录库，会对业务侵入，业务还要关心这个库，是否一个合理的设计？</p>
<p>实际上可以依靠运维的手段来简化开发的侵入，我们的方法是让 DBA 在公司所有 MySQL 实例上预初始化这个库，通过框架层（消息的客户端或事务 RPC 框架）透明的在背后操作这个库，业务开发人员只需要关心自己的业务逻辑，不需要直接访问这个库。</p>
<p>总结起来，其实两种方式的根本原理是类似的，也就是<strong>将分布式事务转换为多个本地事务，然后依靠重试等方式达到最终一致性。</strong> </p>
<h2 id="蘑菇街交易创建过程中的分布式一致性方案"><a href="#蘑菇街交易创建过程中的分布式一致性方案" class="headerlink" title="蘑菇街交易创建过程中的分布式一致性方案"></a>蘑菇街交易创建过程中的分布式一致性方案</h2><p>交易创建的一般性流程</p>
<p>我们把交易创建流程抽象出一系列可扩展的功能点，每个功能点都可以有多个实现（具体的实现之间有组合/互斥关系）。把各个功能点按照一定流程串起来，就完成了交易创建的过程。 </p>
<p><img src="https://ww1.sinaimg.cn/large/006kbv1Jgw1f31xdryziuj30i008d0tu.jpg" alt="function"></p>
<p><strong>面临的问题</strong></p>
<p>每个功能点的实现都可能会依赖外部服务。那么如何保证各个服务之间的数据是一致的呢？比如锁定优惠券服务调用超时了，不能确定到底有没有锁券成功，该如何处理？再比如锁券成功了，但是扣减库存失败了，该如何处理？</p>
<p><strong>方案选型</strong></p>
<p>服务依赖过多，会带来管理复杂性增加和稳定性风险增大的问题。试想如果我们强依赖 10 个服务，9 个都执行成功了，最后一个执行失败了，那么是不是前面 9 个都要回滚掉？这个成本还是非常高的。</p>
<p>所以在拆分大的流程为多个小的本地事务的前提下，对于非实时、非强一致性的关联业务写入，在本地事务执行成功后，我们选择发消息通知、关联事务异步化执行的方案。</p>
<p><strong>消息通知往往不能保证 100% 成功；且消息通知后，接收方业务是否能执行成功还是未知数。前者问题可以通过重试解决；后者可以选用事务消息来保证。</strong></p>
<p>但是事务消息框架本身会给业务代码带来侵入性和复杂性，所以我们选择基于 DB 事件变化通知到 MQ 的方式做系统间解耦，通过订阅方消费 MQ 消息时的 ACK 机制，保证消息一定消费成功，达到最终一致性。由于消息可能会被重发，消息订阅方业务逻辑处理要做好幂等保证。</p>
<p>所以目前只剩下需要实时同步做、有强一致性要求的业务场景了。在交易创建过程中，锁券和扣减库存是这样的两个典型场景。</p>
<p>要保证多个系统间数据一致，乍一看，必须要引入分布式事务框架才能解决。但引入非常重的类似二阶段提交分布式事务框架会带来复杂性的急剧上升；在电商领域，绝对的强一致是过于理想化的，我们可以选择准实时的最终一致性。</p>
<p>我们在交易创建流程中，首先创建一个不可见订单，然后在同步调用锁券和扣减库存时，针对调用异常（失败或者超时），发出废单消息到MQ。如果消息发送失败，本地会做时间阶梯式的异步重试；优惠券系统和库存系统收到消息后，会进行判断是否需要做业务回滚，这样就准实时地保证了多个本地事务的最终一致性。</p>
<p><img src="https://ww2.sinaimg.cn/large/006kbv1Jgw1f31xeajfqkj30680i2wez.jpg" alt="下单"></p>
<h2 id="支付宝及蚂蚁金融云的分布式服务-DTS-方案"><a href="#支付宝及蚂蚁金融云的分布式服务-DTS-方案" class="headerlink" title="支付宝及蚂蚁金融云的分布式服务 DTS 方案"></a>支付宝及蚂蚁金融云的分布式服务 DTS 方案</h2><p>业界常用的还有支付宝的一种 xts 方案，由支付宝在 2PC 的基础上改进而来。主要思路如下，大部分信息引用自官方网站。</p>
<h3 id="分布式事务服务简介"><a href="#分布式事务服务简介" class="headerlink" title="分布式事务服务简介"></a>分布式事务服务简介</h3><p>分布式事务服务 (Distributed Transaction Service, DTS) 是一个分布式事务框架，用来保障在大规模分布式环境下事务的最终一致性。DTS 从架构上分为 xts-client 和 xts-server 两部分，前者是一个嵌入客户端应用的 JAR 包，主要负责事务数据的写入和处理；后者是一个独立的系统，主要负责异常事务的恢复。</p>
<h3 id="核心特性"><a href="#核心特性" class="headerlink" title="核心特性"></a>核心特性</h3><p>传统关系型数据库的事务模型必须遵守 ACID 原则。在单数据库模式下，ACID 模型能有效保障数据的完整性，但是在大规模分布式环境下，一个业务往往会跨越多个数据库，如何保证这多个数据库之间的数据一致性，需要其他行之有效的策略。在 JavaEE 规范中使用 2PC (2 Phase Commit, 两阶段提交) 来处理跨 DB 环境下的事务问题，但是 2PC 是反可伸缩模式，也就是说，在事务处理过程中，参与者需要一直持有资源直到整个分布式事务结束。这样，当业务规模达到千万级以上时，2PC 的局限性就越来越明显，系统可伸缩性会变得很差。基于此，我们采用 BASE 的思想实现了一套类似 2PC 的分布式事务方案，这就是 DTS。DTS在充分保障分布式环境下高可用性、高可靠性的同时兼顾数据一致性的要求，其最大的特点是保证数据最终一致 (Eventually consistent)。</p>
<p>简单的说，DTS 框架有如下特性：</p>
<ul>
<li>最终一致：事务处理过程中，会有短暂不一致的情况，但通过恢复系统，可以让事务的数据达到最终一致的目标。</li>
<li>协议简单：DTS 定义了类似 2PC 的标准两阶段接口，业务系统只需要实现对应的接口就可以使用 DTS 的事务功能。</li>
<li>与 RPC 服务协议无关：在 SOA 架构下，一个或多个 DB 操作往往被包装成一个一个的 Service，Service 与 Service 之间通过 RPC 协议通信。DTS 框架构建在 SOA 架构上，与底层协议无关。</li>
<li>与底层事务实现无关： DTS 是一个抽象的基于 Service 层的概念，与底层事务实现无关，也就是说在 DTS 的范围内，无论是关系型数据库 MySQL，Oracle，还是 KV 存储 MemCache，或者列存数据库 HBase，只要将对其的操作包装成 DTS 的参与者，就可以接入到 DTS 事务范围内。</li>
</ul>
<p>以下是分布式事务框架的流程图<br><img src="https://ww2.sinaimg.cn/large/006kbv1Jgw1f31xfuizhpj30a70b7q3x.jpg" alt="flow"></p>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><ol>
<li>一个完整的业务活动由一个主业务服务与若干从业务服务组成。</li>
<li>主业务服务负责发起并完成整个业务活动。</li>
<li>从业务服务提供 TCC 型业务操作。</li>
<li>业务活动管理器控制业务活动的一致性，它登记业务活动中的操作，并在活动提交时确认所有的两阶段事务的 confirm 操作，在业务活动取消时调用所有两阶段事务的 cancel 操作。”</li>
</ol>
<p><strong>与 2PC 协议比较</strong></p>
<ol>
<li>没有单独的 Prepare 阶段，降低协议成本</li>
<li>系统故障容忍度高，恢复简单</li>
</ol>
<h2 id="农信网数据一致性方案"><a href="#农信网数据一致性方案" class="headerlink" title="农信网数据一致性方案"></a>农信网数据一致性方案</h2><h3 id="电商业务"><a href="#电商业务" class="headerlink" title="电商业务"></a>电商业务</h3><p>公司的支付部门，通过接入其它第三方支付系统来提供支付服务给业务部门，支付服务是一个基于 Dubbo 的 RPC 服务。<br>对于业务部门来说，电商部门的订单支付，需要调用</p>
<ol>
<li>支付平台的支付接口来处理订单；</li>
<li>同时需要调用积分中心的接口，按照业务规则，给用户增加积分。</li>
</ol>
<p>从业务规则上需要同时保证业务数据的实时性和一致性，也就是支付成功必须加积分。</p>
<p>我们采用的方式是同步调用，首先处理本地事务业务。考虑到积分业务比较单一且业务影响低于支付，由积分平台提供增加与回撤接口。</p>
<p>具体的流程是先调用积分平台增加用户积分，再调用支付平台进行支付处理，如果处理失败，catch 方法调用积分平台的回撤方法，将本次处理的积分订单回撤。<br><img src="https://ww3.sinaimg.cn/large/006kbv1Jgw1f31xgmb4wrj30hl09rgmn.jpg" alt="pic"></p>
<h3 id="用户信息变更"><a href="#用户信息变更" class="headerlink" title="用户信息变更"></a>用户信息变更</h3><p>公司的用户信息，统一由用户中心维护，而用户信息的变更需要同步给各业务子系统，业务子系统再根据变更内容，处理各自业务。用户中心作为 MQ 的 producer，添加通知给 MQ。APP Server 订阅该消息，同步本地数据信息，再处理相关业务比如 APP 退出下线等。</p>
<p>我们采用异步消息通知机制，目前主要使用 ActiveMQ，基于 Virtual Topic 的订阅方式，保证单个业务集群订阅的单次消费。<br><img src="https://ww1.sinaimg.cn/large/006kbv1Jgw1f31xhl94fyj30hu08qt9j.jpg" alt="信息变更"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>分布式服务对衍生的配套系统要求比较多，特别是我们基于消息、日志的最终一致性方案，需要考虑消息的积压、消费情况、监控、报警等。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li>Base: An Acid Alternative (eBay 方案)</li>
</ol>
<p>In partitioned databases, trading some consistency for availability can lead to dramatic improvements in scalability.</p>
<p>英文版 ： <a href="http://queue.acm.org/detail.cfm?id=1394128" target="_blank" rel="external">http://queue.acm.org/detail.cfm?id=1394128</a> </p>
<p>中文版： <a href="http://article.yeeyan.org/view/167444/125572" target="_blank" rel="external">http://article.yeeyan.org/view/167444/125572</a></p>
<ol>
<li>分布式事务服务 (DTS)  <a href="https://www.cloud.alipay.com/docs/middleware/xts/index.html" target="_blank" rel="external">https://www.cloud.alipay.com/docs/middleware/xts/index.html</a></li>
</ol>
<p>感谢李玉福、余昭辉、蘑菇街七公提供方案，其他多位群成员对本文内容亦有贡献。</p>
<p>本文编辑李玉福、Tim Yang，转载请注明来自<img src="http://weibo.com/archnotes" alt="@高可用架构">​​​​</p>
]]></content>
      
        <categories>
            
            <category> 架构 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 分布式系统 </tag>
            
            <tag> 一致性 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[mysql查询数据库和表所占空间大小]]></title>
      <url>/2017/08/08/mysql-space-used/</url>
      <content type="html"><![CDATA[<h2 id="查询数据库所占空间大小"><a href="#查询数据库所占空间大小" class="headerlink" title="查询数据库所占空间大小"></a>查询数据库所占空间大小</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> <span class="built_in">sum</span>(DATA_LENGTH)+<span class="built_in">sum</span>(INDEX_LENGTH) <span class="keyword">FROM</span> information_schema.TABLES <span class="keyword">WHERE</span> D</div></pre></td></tr></table></figure>
<p>得到的结果是单位是字节Byte</p>
<h2 id="查询数据库中所有表所占空间的大小"><a href="#查询数据库中所有表所占空间的大小" class="headerlink" title="查询数据库中所有表所占空间的大小"></a>查询数据库中所有表所占空间的大小</h2><a id="more"></a>
<p>在数据库的中的<strong>information_schema</strong>数据库中有一个 TABLES 表，这个表主要字段分别是：</p>
<table>
<thead>
<tr>
<th>字段名</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>TABLE_SCHEMA</td>
<td>数据库名</td>
</tr>
<tr>
<td>TABLE_NAME</td>
<td>表名</td>
</tr>
<tr>
<td>ENGINE</td>
<td>所使用的存储引擎</td>
</tr>
<tr>
<td>TABLES_ROWS</td>
<td>记录数</td>
</tr>
<tr>
<td>DATA_LENGTH</td>
<td>数据大小</td>
</tr>
<tr>
<td>INDEX_LENGTH</td>
<td>索引大小</td>
</tr>
</tbody>
</table>
<ul>
<li>查询所有表数据和索引的的大小</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> TABLE_NAME,DATA_LENGTH+INDEX_LENGTH,TABLE_ROWS <span class="keyword">FROM</span> information_schema.TABLES <span class="keyword">WHERE</span> TABLE_SCHEMA=<span class="string">"数据库名"</span>;</div></pre></td></tr></table></figure>
<ul>
<li>查询某个表的数据大小和索引大小</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELECT TABLE_NAME,DATA_LENGTH+INDEX_LENGTH,TABLE_ROWS <span class="keyword">FROM</span> information_schema.TABLES WHERE <span class="attribute">TABLE_SCHEMA</span>=<span class="string">"数据库名"</span> <span class="keyword">AND</span> <span class="attribute">TABLE_NAME</span>=<span class="string">"表名"</span>;</div></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> mysql </category>
            
        </categories>
        
        
        <tags>
            
            <tag> mysql </tag>
            
            <tag> 数据库 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[必须好使的git命令]]></title>
      <url>/2017/07/29/useful-git-command/</url>
      <content type="html"><![CDATA[<h2 id="git设置颜色高亮显示"><a href="#git设置颜色高亮显示" class="headerlink" title="git设置颜色高亮显示"></a>git设置颜色高亮显示</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git<span class="built_in"> config </span>--global  color.ui <span class="literal">true</span></div></pre></td></tr></table></figure>
<h2 id="git-命令别名设置"><a href="#git-命令别名设置" class="headerlink" title="git 命令别名设置"></a>git 命令别名设置</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git<span class="built_in"> config </span>--global  alias.br   branch</div></pre></td></tr></table></figure>
<a id="more"></a>
<h2 id="查看git提交日志"><a href="#查看git提交日志" class="headerlink" title="查看git提交日志"></a>查看git提交日志</h2><figure class="highlight 1c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">log</span></div></pre></td></tr></table></figure>
<h2 id="查看最近的提交内容"><a href="#查看最近的提交内容" class="headerlink" title="查看最近的提交内容"></a>查看最近的提交内容</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">git <span class="keyword">show</span>          #最近一次</div><div class="line">git <span class="keyword">show</span> <span class="keyword">HEAD</span>^    #往前推一次,等于git <span class="keyword">show</span> <span class="keyword">HEAD</span>~<span class="number">1</span> </div><div class="line">git <span class="keyword">show</span> <span class="keyword">HEAD</span>^^   #往前推两次,等于git <span class="keyword">show</span> <span class="keyword">HEAD</span>~<span class="number">2</span></div></pre></td></tr></table></figure>
<p><strong>找到规律的同学应该知道怎么看更早之前的记录了</strong></p>
<h2 id="一次加入所有修改，包括delete"><a href="#一次加入所有修改，包括delete" class="headerlink" title="一次加入所有修改，包括delete"></a>一次加入所有修改，包括delete</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git <span class="keyword">add</span><span class="bash"> -u         <span class="comment">#一次加入所有被修改的内容，包含 modified 及 deleted</span></span></div><div class="line"><span class="bash">git add --update   <span class="comment">#同上</span></span></div></pre></td></tr></table></figure>
<h2 id="移动文件或重命名"><a href="#移动文件或重命名" class="headerlink" title="移动文件或重命名"></a>移动文件或重命名</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git mv my_folder/numbers<span class="selector-class">.txt</span> .   #将my_folder/numbers.txt文件移动到当前目录,文件名不变</div><div class="line">git mv numbers<span class="selector-class">.txt</span> num<span class="selector-class">.txt</span>        #修改文件名</div></pre></td></tr></table></figure>
<h2 id="Git将”尚未被提交”的内容分成三种类型，分別是"><a href="#Git将”尚未被提交”的内容分成三种类型，分別是" class="headerlink" title="Git将”尚未被提交”的内容分成三种类型，分別是"></a>Git将”尚未被提交”的内容分成三种类型，分別是</h2><ul>
<li>Changes to be committed（将要提交的内容）</li>
<li>Changes not staged for commit（被修改但未提交）</li>
<li>Untracked files（没有如版本库的文件）</li>
</ul>
<h2 id="撤销修改"><a href="#撤销修改" class="headerlink" title="撤销修改"></a>撤销修改</h2><ol>
<li>变回未修改状态</li>
</ol>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git checkout <span class="comment">-- &lt;file&gt;</span></div></pre></td></tr></table></figure>
<ol>
<li>回到未提交状态</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git <span class="keyword">reset</span> <span class="keyword">HEAD</span> &lt;<span class="keyword">file</span>&gt;</div></pre></td></tr></table></figure>
<h2 id="回到指定版本"><a href="#回到指定版本" class="headerlink" title="回到指定版本"></a>回到指定版本</h2><figure class="highlight fortran"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">log</span> --oneline  #显示<span class="built_in">log</span>日志，但只显示commit id和提交描述</div><div class="line"></div><div class="line">a2ba80 First commit</div><div class="line"><span class="number">80635e7</span> 增加<span class="built_in">index</span>.html文件</div><div class="line">c65ef5e Create README.md</div></pre></td></tr></table></figure>
<p>选择commit id 使用下述命令回到指定版本</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git <span class="keyword">reset</span> <span class="comment">--hard 5a2ba80</span></div></pre></td></tr></table></figure>
<h2 id="查看git历史修改记录"><a href="#查看git历史修改记录" class="headerlink" title="查看git历史修改记录"></a>查看git历史修改记录</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">git reflog                                    <span class="comment">#查看所有记录</span></div><div class="line">80635e7 HEAD<span class="meta">@&#123;2&#125;:</span> commit: 增加index.html文件   <span class="comment">#三列;1是commit id;2是short name;3是描述</span></div><div class="line">git show <span class="variable">&lt;commit id&gt;</span>                          <span class="comment">#查看指定记录</span></div><div class="line">git show <span class="variable">&lt;short name&gt;</span>                         <span class="comment">#同上</span></div></pre></td></tr></table></figure>
<h2 id="分支管理"><a href="#分支管理" class="headerlink" title="分支管理"></a>分支管理</h2><h3 id="创建并删除分支"><a href="#创建并删除分支" class="headerlink" title="创建并删除分支"></a>创建并删除分支</h3><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">git <span class="keyword">branch </span>develop</div><div class="line">git checkout -<span class="keyword">b </span>&lt;new <span class="keyword">branch </span>name&gt;  <span class="comment">#建立分支并切换到该分支</span></div><div class="line">git <span class="keyword">branch </span>-f &lt;new <span class="keyword">branch </span>name&gt; &lt;commit id&gt; <span class="comment">#在指定版本上建立分支</span></div><div class="line">git <span class="keyword">branch </span>-D &lt;<span class="keyword">branch </span>name&gt; <span class="comment">#删除分支</span></div></pre></td></tr></table></figure>
<h3 id="修改远程分支名称"><a href="#修改远程分支名称" class="headerlink" title="修改远程分支名称"></a>修改远程分支名称</h3><p>一般来说，我们主要的分支都是origin，但其实这个名字是可以改的<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git remote <span class="built_in">rename</span> <span class="built_in">origin</span> github</div></pre></td></tr></table></figure></p>
<h3 id="上传分支需改"><a href="#上传分支需改" class="headerlink" title="上传分支需改"></a>上传分支需改</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git push &lt;remote <span class="built_in">name</span>&gt; &lt;branch <span class="built_in">name</span>&gt;</div></pre></td></tr></table></figure>
<h3 id="删除远端分支"><a href="#删除远端分支" class="headerlink" title="删除远端分支"></a>删除远端分支</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git push &lt;remote <span class="built_in">name</span>&gt; :&lt;branch <span class="built_in">name</span>&gt;</div></pre></td></tr></table></figure>
<h3 id="查看分支"><a href="#查看分支" class="headerlink" title="查看分支"></a>查看分支</h3><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git <span class="keyword">branch </span>       <span class="comment">#只看本地分支</span></div><div class="line">git <span class="keyword">branch </span>-a     <span class="comment">#查看本地及远程分支</span></div></pre></td></tr></table></figure>
<h2 id="版本暂存"><a href="#版本暂存" class="headerlink" title="版本暂存"></a>版本暂存</h2><figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">git stash   <span class="comment">#暂存目前修改的内容</span></div><div class="line">git stash list <span class="comment"># 列出所有暂存的内容</span></div><div class="line">git show stash@&#123;0&#125; <span class="comment">#显示暂存内容的详情</span></div><div class="line">git stash <span class="keyword">pop</span>  <span class="comment">#取出最近一次暂存的内容</span></div><div class="line">git stash <span class="keyword">pop</span> stash@&#123;n&#125; <span class="comment">#取出指定的暂存内容</span></div><div class="line">git stash drop <span class="comment">#删除暂存的内容</span></div><div class="line">git stash drop stash@&#123;n&#125;  <span class="comment">#删除指定的暂存内容</span></div><div class="line">git stash clear <span class="comment">#清空暂存区</span></div></pre></td></tr></table></figure>
<h2 id="子模块"><a href="#子模块" class="headerlink" title="子模块"></a>子模块</h2><h3 id="添加子模块"><a href="#添加子模块" class="headerlink" title="添加子模块"></a>添加子模块</h3><p>如果我们用到外部依赖的库的时候，通常需要使用子模块来实现</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git <span class="keyword">submodule </span><span class="keyword">add </span>git@github.com:<span class="keyword">jquery/jquery.git </span><span class="keyword">jquery </span> <span class="comment">#添加jquery作为子模块</span></div></pre></td></tr></table></figure>
<h3 id="初始化子模块"><a href="#初始化子模块" class="headerlink" title="初始化子模块"></a>初始化子模块</h3><p>使用子模块的项目在clone出新的项目后，必须初始化子模块内容<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">git</span> <span class="keyword">submodule </span>init</div><div class="line"><span class="symbol">git</span> <span class="keyword">submodule </span>update</div></pre></td></tr></table></figure></p>
<p>在clone的时候加上<strong>--recursive</strong>可以直接完成子模块的初始化<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git <span class="keyword">clone</span> <span class="title">--recursive</span> git@github.com:zlargon/git-test.git</div></pre></td></tr></table></figure></p>
<h3 id="删除子模块"><a href="#删除子模块" class="headerlink" title="删除子模块"></a>删除子模块</h3><ol>
<li>删除子模块<br><code>rm -rf &lt;submodule path&gt;</code></li>
<li>刪除.gitmodules 里边的submodule设置</li>
<li>提交修改</li>
<li>刪除 .git/config 里面的submodule 设置内容</li>
<li>刪除 .git/modules/<module name="">里边的内容</module></li>
</ol>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://www.gitbook.com/book/zlargon/git-tutorial/details" target="_blank" rel="external">Git使用说明</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> 工具 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Git </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[一些小技巧]]></title>
      <url>/2017/07/29/some_tips/</url>
      <content type="html"><![CDATA[<h2 id="macos设置从终端启动sublime"><a href="#macos设置从终端启动sublime" class="headerlink" title="macos设置从终端启动sublime"></a>macos设置从终端启动sublime</h2><blockquote>
<p>alias subl=\’’/Applications/Sublime Text.app/Contents/SharedSupport/bin/subl’\’</p>
</blockquote>
<p><em>说明：其实就是设置了一个别名</em></p>
<p><strong>to be continue……</strong></p>
]]></content>
      
        <categories>
            
            <category> 工具 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> tips </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[My First Hexo blog]]></title>
      <url>/2017/07/29/My-First-Hexo-blog/</url>
      <content type="html"><![CDATA[<script src="/crypto-js.js"></script><script src="/mcommon.js"></script><h3 id="encrypt-message">sorry, you can't read this post!</h3><link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css"> <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap-theme.min.css"> <script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script> <script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script> <div id="security"> <div> <div class="input-group"> <input type="text" class="form-control" aria-label="Enter the password." id="pass"/> <div class="input-group-btn"> <button type="button" class="btn btn-default" onclick="decryptAES()">Decrypt</button> </div> </div> </div> </div> <div id="encrypt-blog" style="display:none"> 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 </div>]]></content>
      
        <categories>
            
            <category> 个人生活 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> houhou </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Hello World]]></title>
      <url>/2017/07/29/hello-world/</url>
      <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<a id="more"></a>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div><div class="line"><span class="comment">#debug模式</span></div><div class="line">$ hexo server --debug</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div><div class="line"><span class="comment">#缩写</span></div><div class="line">$ hexo g</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div><div class="line"><span class="comment">#缩写</span></div><div class="line">$ hexo d</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
]]></content>
      
        
    </entry>
    
  
  
</search>
